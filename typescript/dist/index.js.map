{"version":3,"sources":["../json/au_mappings.json","../config/au_mapper.ts","../core/geometry_utils.ts","../json/physical_validations.json","../config/physical_validator.ts","../analyzers/hybrid_engine.ts","../analyzers/landmark_based_flow.ts","../config/thresholds_config.ts","../json/FACS_IA_decision_ready_v1.json","../config/facs_config.ts","../logic/scoring_engine.ts","../modules/gaze_tracker.ts","../modules/landmark_tracker.ts","../modules/voice_activity.ts","../index.ts"],"names":["process","IDX_NOSE"],"mappings":";AAAA,IAAA,mBAAA,GAAA;AAAA,EAGE,QAAA,EAAY;AAAA,IACV,GAAA,EAAO;AAAA,MACL,IAAA,EAAQ,QAAA;AAAA,MACR,WAAA,EAAe,CAAC,aAAa;AAAA,KAC/B;AAAA,IACA,GAAA,EAAO;AAAA,MACL,IAAA,EAAQ,SAAA;AAAA,MACR,WAAA,EAAe,CAAC,iBAAA,EAAmB,kBAAkB;AAAA,KACvD;AAAA,IACA,GAAA,EAAO;AAAA,MACL,IAAA,EAAQ,WAAA;AAAA,MACR,IAAA,EAAQ;AAAA,QACN,IAAA,EAAQ,SAAA;AAAA,QACR,WAAA,EAAe,CAAC,cAAA,EAAgB,eAAe;AAAA,OACjD;AAAA,MACA,SAAA,EAAa;AAAA,QACX;AAAA,UACE,MAAA,EAAU,KAAA;AAAA,UACV,UAAA,EAAc;AAAA;AAChB;AACF,KACF;AAAA,IACA,GAAA,EAAO;AAAA,MACL,IAAA,EAAQ,SAAA;AAAA,MACR,WAAA,EAAe,CAAC,aAAA,EAAe,cAAc;AAAA,KAC/C;AAAA,IACA,GAAA,EAAO;AAAA,MACL,IAAA,EAAQ,SAAA;AAAA,MACR,WAAA,EAAe,CAAC,iBAAA,EAAmB,kBAAkB;AAAA,KACvD;AAAA,IACA,GAAA,EAAO;AAAA,MACL,IAAA,EAAQ,SAAA;AAAA,MACR,WAAA,EAAe,CAAC,eAAA,EAAiB,gBAAgB;AAAA,KACnD;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,IAAA,EAAQ,SAAA;AAAA,MACR,WAAA,EAAe,CAAC,cAAA,EAAgB,eAAe;AAAA,KACjD;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,IAAA,EAAQ,WAAA;AAAA,MACR,MAAA,EAAU;AAAA,KACZ;AAAA,IACA,GAAA,EAAO;AAAA,MACL,IAAA,EAAQ,SAAA;AAAA,MACR,WAAA,EAAe,CAAC,eAAA,EAAiB,gBAAgB;AAAA,KACnD;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,IAAA,EAAQ,SAAA;AAAA,MACR,WAAA,EAAe,CAAC,kBAAA,EAAoB,mBAAmB;AAAA,KACzD;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,IAAA,EAAQ,WAAA;AAAA,MACR,IAAA,EAAQ;AAAA,QACN,IAAA,EAAQ,SAAA;AAAA,QACR,WAAA,EAAe,CAAC,gBAAA,EAAkB,iBAAiB;AAAA,OACrD;AAAA,MACA,SAAA,EAAa;AAAA,QACX;AAAA,UACE,MAAA,EAAU;AAAA,YACR,IAAA,EAAQ,SAAA;AAAA,YACR,WAAA,EAAe,CAAC,iBAAA,EAAmB,kBAAkB;AAAA,WACvD;AAAA,UACA,UAAA,EAAc;AAAA;AAChB;AACF,KACF;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,IAAA,EAAQ,SAAA;AAAA,MACR,WAAA,EAAe,CAAC,iBAAA,EAAmB,kBAAkB;AAAA,KACvD;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,IAAA,EAAQ,SAAA;AAAA,MACR,WAAA,EAAe,CAAC,gBAAA,EAAkB,iBAAiB;AAAA,KACrD;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,IAAA,EAAQ,QAAA;AAAA,MACR,WAAA,EAAe,CAAC,WAAW;AAAA,KAC7B;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,IAAA,EAAQ,QAAA;AAAA,MACR,WAAA,EAAe,CAAC,aAAa;AAAA,KAC/B;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,IAAA,EAAQ,SAAA;AAAA,MACR,WAAA,EAAe,CAAC,kBAAA,EAAoB,mBAAmB;AAAA,KACzD;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,IAAA,EAAQ,WAAA;AAAA,MACR,IAAA,EAAQ;AAAA,QACN,IAAA,EAAQ,SAAA;AAAA,QACR,WAAA,EAAe,CAAC,gBAAA,EAAkB,iBAAiB;AAAA,OACrD;AAAA,MACA,UAAA,EAAc;AAAA,KAChB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,IAAA,EAAQ,SAAA;AAAA,MACR,WAAA,EAAe,CAAC,gBAAA,EAAkB,iBAAiB;AAAA,KACrD;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,IAAA,EAAQ,QAAA;AAAA,MACR,WAAA,EAAe,CAAC,SAAS;AAAA,KAC3B;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,IAAA,EAAQ,QAAA;AAAA,MACR,WAAA,EAAe,CAAC,SAAS;AAAA,KAC3B;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,IAAA,EAAQ,SAAA;AAAA,MACR,WAAA,EAAe,CAAC,gBAAA,EAAkB,gBAAgB;AAAA;AACpD;AAEJ,CAAA;;;ACtEA,SAAS,qBAAA,CACR,OAAA,EACA,EAAA,EACA,aAAA,EACS;AACT,EAAA,QAAQ,QAAQ,IAAA;AAAM,IACrB,KAAK,QAAA,EAAU;AACd,MAAA,MAAM,QAAQ,OAAA,CAAQ,WAAA,CACpB,GAAA,CAAI,CAAC,SAAS,EAAA,CAAG,IAAI,CAAA,IAAK,CAAC,EAC3B,MAAA,CAAO,CAAC,KAAK,GAAA,KAAQ,GAAA,GAAM,KAAK,CAAC,CAAA;AACnC,MAAA,OAAO,KAAA;AAAA,IACR;AAAA,IAEA,KAAK,SAAA,EAAW;AACf,MAAA,MAAM,MAAA,GAAS,QAAQ,WAAA,CAAY,GAAA,CAAI,CAAC,IAAA,KAAS,EAAA,CAAG,IAAI,CAAA,IAAK,CAAC,CAAA;AAC9D,MAAA,IAAI,MAAA,CAAO,MAAA,KAAW,CAAA,EAAG,OAAO,CAAA;AAChC,MAAA,MAAM,GAAA,GAAM,OAAO,MAAA,CAAO,CAAC,KAAK,GAAA,KAAQ,GAAA,GAAM,KAAK,CAAC,CAAA;AACpD,MAAA,OAAO,MAAM,MAAA,CAAO,MAAA;AAAA,IACrB;AAAA,IAEA,KAAK,WAAA,EAAa;AACjB,MAAA,OAAO,aAAA,CAAc,OAAA,CAAQ,MAAM,CAAA,IAAK,CAAA;AAAA,IACzC;AAAA,IAEA,KAAK,WAAA,EAAa;AACjB,MAAA,IAAI,KAAA,GAAQ,qBAAA,CAAsB,OAAA,CAAQ,IAAA,EAAM,IAAI,aAAa,CAAA;AAEjE,MAAA,IAAI,OAAA,CAAQ,eAAe,MAAA,EAAW;AACrC,QAAA,KAAA,IAAS,OAAA,CAAQ,UAAA;AAAA,MAClB;AAEA,MAAA,IAAI,QAAQ,SAAA,EAAW;AACtB,QAAA,KAAA,MAAW,QAAA,IAAY,QAAQ,SAAA,EAAW;AACzC,UAAA,IAAI,aAAA;AACJ,UAAA,IAAI,OAAO,QAAA,CAAS,MAAA,KAAW,QAAA,EAAU;AACxC,YAAA,aAAA,GAAgB,aAAA,CAAc,QAAA,CAAS,MAAM,CAAA,IAAK,CAAA;AAAA,UACnD,CAAA,MAAO;AACN,YAAA,aAAA,GAAgB,qBAAA;AAAA,cACf,QAAA,CAAS,MAAA;AAAA,cACT,EAAA;AAAA,cACA;AAAA,aACD;AAAA,UACD;AACA,UAAA,KAAA,IAAS,gBAAgB,QAAA,CAAS,UAAA;AAAA,QACnC;AAAA,MACD;AAEA,MAAA,OAAO,KAAA;AAAA,IACR;AAAA,IAEA;AACC,MAAA,OAAO,CAAA;AAAA;AAEV;AAEO,SAAS,yBAAyB,EAAA,EAAgC;AACxE,EAAA,MAAM,MAAA,GAAS,mBAAA;AACf,EAAA,MAAM,MAAmB,EAAC;AAE1B,EAAA,MAAM,OAAA,GAAU,MAAA,CAAO,IAAA,CAAK,MAAA,CAAO,QAAQ,CAAA;AAC3C,EAAA,KAAA,MAAW,UAAU,OAAA,EAAS;AAC7B,IAAA,MAAM,OAAA,GAAU,MAAA,CAAO,QAAA,CAAS,MAAM,CAAA;AACtC,IAAA,GAAA,CAAI,MAAM,CAAA,GAAI,qBAAA,CAAsB,OAAA,EAAsB,IAAI,GAAG,CAAA;AAAA,EAClE;AAEA,EAAA,OAAO,GAAA;AACR;;;ACvGO,SAAS,iBAAA,CACf,IACA,EAAA,EACS;AACT,EAAA,OAAO,IAAA,CAAK,IAAA;AAAA,IAAA,CACV,EAAA,CAAG,CAAA,GAAI,EAAA,CAAG,CAAA,KAAM,CAAA,GAAA,CAAK,EAAA,CAAG,CAAA,GAAI,EAAA,CAAG,CAAA,KAAM,CAAA,GAAA,CAAK,EAAA,CAAG,CAAA,GAAI,GAAG,CAAA,KAAM;AAAA,GAC5D;AACD;AA4DO,SAAS,mBAAA,CACf,SAAA,EACA,OAAA,EACA,CAAA,EACA,CAAA,EACS;AACT,EAAA,MAAM,GAAA,GAA0B,OAAA,CAAQ,GAAA,CAAI,CAAC,CAAA,KAAM;AAClD,IAAA,MAAM,QAAA,GAAW,UAAU,CAAC,CAAA;AAC5B,IAAA,IAAI,CAAC,QAAA,EAAU,OAAO,CAAC,GAAG,CAAC,CAAA;AAC3B,IAAA,OAAO,CAAC,QAAA,CAAS,CAAA,GAAI,CAAA,EAAG,QAAA,CAAS,IAAI,CAAC,CAAA;AAAA,EACvC,CAAC,CAAA;AAED,EAAA,IAAI,GAAA,CAAI,MAAA,KAAW,CAAA,EAAG,OAAO,CAAA;AAE7B,EAAA,MAAM,OAAA,GAAU,GAAA,CAAI,MAAA,CAAO,CAAC,GAAA,EAAK,EAAA,KAAO,GAAA,GAAM,EAAA,CAAG,CAAC,CAAA,EAAG,CAAC,CAAA,GAAI,GAAA,CAAI,MAAA;AAC9D,EAAA,MAAM,OAAA,GAAU,GAAA,CAAI,MAAA,CAAO,CAAC,GAAA,EAAK,EAAA,KAAO,GAAA,GAAM,EAAA,CAAG,CAAC,CAAA,EAAG,CAAC,CAAA,GAAI,GAAA,CAAI,MAAA;AAE9D,EAAA,IAAI,UAAA,GAAa,CAAA;AACjB,EAAA,KAAA,MAAW,MAAM,GAAA,EAAK;AACrB,IAAA,MAAM,CAAC,CAAA,EAAG,CAAC,CAAA,GAAI,EAAA;AACf,IAAA,MAAM,IAAA,GAAO,KAAK,IAAA,CAAA,CAAM,CAAA,GAAI,YAAY,CAAA,GAAA,CAAK,CAAA,GAAI,YAAY,CAAC,CAAA;AAC9D,IAAA,UAAA,IAAc,IAAA;AAAA,EACf;AAEA,EAAA,OAAO,UAAA;AACR;;;ACnGA,IAAA,4BAAA,GAAA;AAAA,EAGE,WAAA,EAAe;AAAA,IACb,GAAA,EAAO;AAAA,MACL,IAAA,EAAQ,YAAA;AAAA,MACR,WAAA,EAAe,kFAAA;AAAA,MACf,iBAAmB,CAAC,GAAA,EAAK,GAAA,EAAK,CAAA,EAAG,IAAI,GAAG,CAAA;AAAA,MACxC,UAAA,EAAc;AAAA,QACZ,WAAA,EAAe,IAAA;AAAA,QACf,wBAAA,EAA4B;AAAA,OAC9B;AAAA,MACA,MAAA,EAAU;AAAA,QACR,IAAA,EAAQ,UAAA;AAAA,QACR,UAAA,EAAc;AAAA;AAChB;AACF;AAEJ,CAAA;;;ACeO,SAAS,uBAAA,GAA0B;AACzC,EAAA,MAAM,MAAA,GAAS,4BAAA;AACf,EAAA,MAAM,MAAA,uBAAa,GAAA,EAA6B;AAEhD,EAAA,SAAS,gBAAA,CACR,GAAA,EACA,SAAA,EACA,CAAA,EACA,CAAA,EACc;AACd,IAAA,MAAM,MAAA,GAAS,EAAE,GAAG,GAAA,EAAI;AAExB,IAAA,KAAA,MAAW,CAAC,QAAQ,UAAU,CAAA,IAAK,OAAO,OAAA,CAAQ,MAAA,CAAO,WAAW,CAAA,EAAG;AACtE,MAAA,IAAI,UAAA,CAAW,SAAS,YAAA,EAAc;AACrC,QAAA,MAAM,KAAA,GAAQ,MAAA,CAAO,GAAA,CAAI,MAAM,CAAA,IAAK;AAAA,UACnC,WAAA,EAAa,IAAA;AAAA,UACb,UAAA,EAAY;AAAA,SACb;AAEA,QAAA,MAAM,OAAA,GAAU,mBAAA;AAAA,UACf,SAAA;AAAA,UACA,UAAA,CAAW,eAAA;AAAA,UACX,CAAA;AAAA,UACA;AAAA,SACD;AAEA,QAAA,IAAI,CAAC,MAAM,UAAA,EAAY;AACtB,UAAA,KAAA,CAAM,WAAA,GAAc,OAAA;AACpB,UAAA,KAAA,CAAM,UAAA,GAAa,IAAA;AACnB,UAAA,MAAA,CAAO,GAAA,CAAI,QAAQ,KAAK,CAAA;AACxB,UAAA;AAAA,QACD;AAEA,QAAA,MAAM,QAAA,GAAW,OAAA,IAAW,KAAA,CAAM,WAAA,IAAe,CAAA,CAAA;AACjD,QAAA,MAAM,OAAA,GAAU,MAAA,CAAO,MAAM,CAAA,IAAK,CAAA;AAElC,QAAA,IACC,UAAU,UAAA,CAAW,UAAA,CAAW,eAChC,QAAA,GAAW,UAAA,CAAW,WAAW,wBAAA,EAChC;AACD,UAAA,IAAI,UAAA,CAAW,MAAA,CAAO,IAAA,KAAS,UAAA,EAAY;AAC1C,YAAA,MAAA,CAAO,MAAM,CAAA,GAAI,OAAA,GAAU,UAAA,CAAW,MAAA,CAAO,UAAA;AAAA,UAC9C;AAAA,QACD;AAEA,QAAA,MAAA,CAAO,GAAA,CAAI,QAAQ,KAAK,CAAA;AAAA,MACzB;AAAA,IACD;AAEA,IAAA,OAAO,MAAA;AAAA,EACR;AAEA,EAAA,SAAS,gBAAA,GAAyB;AACjC,IAAA,MAAA,CAAO,KAAA,EAAM;AAAA,EACd;AAEA,EAAA,OAAO;AAAA,IACN,gBAAA;AAAA,IACA;AAAA,GACD;AACD;;;ACpEA,SAAS,yBAAyB,SAAA,EAAoC;AACrE,EAAA,IAAI,SAAA,CAAU,MAAA,GAAS,GAAA,EAAK,OAAO,CAAA;AAEnC,EAAA,MAAM,IAAA,GAAO,UAAU,CAAC,CAAA;AACxB,EAAA,MAAM,IAAA,GAAO,UAAU,GAAG,CAAA;AAC1B,EAAA,MAAM,IAAA,GAAO,UAAU,GAAG,CAAA;AAE1B,EAAA,IAAI,CAAC,IAAA,IAAQ,CAAC,IAAA,IAAQ,CAAC,MAAM,OAAO,CAAA;AAEpC,EAAA,MAAM,YAAY,IAAA,CAAK,GAAA,CAAI,IAAA,CAAK,CAAA,GAAI,KAAK,CAAC,CAAA;AAC1C,EAAA,IAAI,SAAA,KAAc,GAAG,OAAO,CAAA;AAE5B,EAAA,MAAM,QAAQ,IAAA,CAAK,GAAA,CAAI,KAAK,CAAA,GAAI,IAAA,CAAK,CAAC,CAAA,GAAI,SAAA;AAC1C,EAAA,MAAM,SAAA,GAAY,IAAA,CAAK,GAAA,CAAI,KAAA,GAAQ,GAAG,CAAA;AAEtC,EAAA,IAAI,YAAY,IAAA,EAAM;AACrB,IAAA,OAAO,IAAA,CAAK,GAAA,CAAA,CAAK,SAAA,GAAY,IAAA,IAAQ,GAAK,CAAG,CAAA;AAAA,EAC9C;AACA,EAAA,OAAO,CAAA;AACR;AAEO,SAAS,kBAAA,GAAmC;AAClD,EAAA,MAAM,WAAA,GAAc,GAAA;AACpB,EAAA,MAAM,SAAA,GAAY,IAAA;AAElB,EAAA,MAAM,KAAA,GAAQ,GAAA;AAEd,EAAA,MAAM,OAAA,uBAAc,GAAA,EAAoB;AAExC,EAAA,MAAM,oBAAoB,uBAAA,EAAwB;AAElD,EAAA,IAAI,gBAA6B,EAAC;AAClC,EAAA,IAAI,kBAAA,GAAqB,KAAA;AAEzB,EAAA,SAAS,UAAU,UAAA,EAA+B;AACjD,IAAA,OAAA,CAAQ,IAAI,0CAA0C,CAAA;AACtD,IAAA,aAAA,GAAgB,EAAE,GAAG,UAAA,EAAW;AAChC,IAAA,kBAAA,GAAqB,IAAA;AAAA,EACtB;AAEA,EAAA,SAAS,gBAAA,GAAyB;AACjC,IAAA,OAAA,CAAQ,IAAI,wBAAwB,CAAA;AACpC,IAAA,aAAA,GAAgB,EAAC;AACjB,IAAA,kBAAA,GAAqB,KAAA;AAAA,EACtB;AAEA,EAAA,SAASA,QAAAA,CACR,WAAA,EACA,SAAA,EACA,CAAA,EACA,CAAA,EACqB;AACrB,IAAA,MAAM,KAA6B,EAAC;AACpC,IAAA,KAAA,MAAW,KAAK,WAAA,EAAa;AAC5B,MAAA,EAAA,CAAG,CAAA,CAAE,aAAa,CAAA,GAAI,CAAA,CAAE,KAAA;AAAA,IACzB;AAEA,IAAA,MAAM,UAAA,GAAa,yBAAyB,SAAS,CAAA;AACrD,IAAA,MAAM,WAAA,GAAc,WAAA,IAAe,CAAA,GAAM,UAAA,GAAa,GAAA,CAAA;AAEtD,IAAA,IAAI,GAAA,GAAmB,yBAAyB,EAAE,CAAA;AAElD,IAAA,GAAA,GAAM,iBAAA,CAAkB,gBAAA,CAAiB,GAAA,EAAK,SAAA,EAAW,GAAG,CAAC,CAAA;AAE7D,IAAA,MAAM,WAAwB,EAAC;AAE/B,IAAA,KAAA,MAAW,CAAC,CAAA,EAAG,CAAC,KAAK,MAAA,CAAO,OAAA,CAAQ,GAAG,CAAA,EAAG;AACzC,MAAA,IAAI,GAAA,GAAA,CAAO,CAAA,IAAK,CAAA,KAAM,IAAA,GAAO,WAAA;AAE7B,MAAA,MAAM,IAAA,GAAO,OAAA,CAAQ,GAAA,CAAI,CAAC,CAAA,IAAK,CAAA;AAC/B,MAAA,MAAM,WAAA,GAAc,GAAA,GAAM,KAAA,GAAQ,IAAA,IAAQ,CAAA,GAAM,KAAA,CAAA;AAEhD,MAAA,OAAA,CAAQ,GAAA,CAAI,GAAG,WAAW,CAAA;AAE1B,MAAA,GAAA,GAAM,WAAA;AAEN,MAAA,IAAI,kBAAA,EAAoB;AACvB,QAAA,MAAM,MAAA,GAAS,aAAA,CAAc,CAAC,CAAA,IAAK,CAAA;AACnC,QAAA,GAAA,GAAM,IAAA,CAAK,GAAA,CAAI,CAAA,EAAK,GAAA,GAAM,MAAM,CAAA;AAAA,MACjC;AAEA,MAAA,IAAI,GAAA,GAAM,WAAW,GAAA,GAAM,CAAA;AAE3B,MAAA,QAAA,CAAS,CAAC,CAAA,GAAI,IAAA,CAAK,GAAA,CAAI,KAAK,CAAG,CAAA;AAAA,IAChC;AAEA,IAAA,OAAO;AAAA,MACN,GAAA,EAAK,QAAA;AAAA,MACL;AAAA,KACD;AAAA,EACD;AAEA,EAAA,OAAO;AAAA,IACN,OAAA,EAAAA,QAAAA;AAAA,IACA,SAAA;AAAA,IACA;AAAA,GACD;AACD;;;ACzFA,IAAM,IAAA,GAAiC;AAAA;AAAA,EAEtC,IAAA,EAAM,CAAC,GAAA,EAAK,GAAA,EAAK,IAAI,GAAG,CAAA;AAAA;AAAA,EAGxB,IAAA,EAAM,CAAC,GAAA,EAAK,GAAA,EAAK,KAAK,EAAE,CAAA;AAAA;AAAA,EAGxB,OAAA,EAAS,CAAC,GAAA,EAAK,GAAA,EAAK,KAAK,EAAE,CAAA;AAAA;AAAA,EAG3B,OAAA,EAAS,CAAC,GAAA,EAAK,GAAA,EAAK,KAAK,GAAG,CAAA;AAAA;AAAA,EAG5B,KAAA,EAAO,CAAC,EAAA,EAAI,GAAA,EAAK,GAAG,EAAE;AACvB,CAAA;AAEA,SAAS,iBAAA,CAAkB,IAAmB,EAAA,EAA2B;AACxE,EAAA,MAAM,EAAA,GAAA,CAAM,EAAA,CAAG,CAAA,GAAI,EAAA,CAAG,CAAA,KAAM,CAAA;AAC5B,EAAA,MAAM,EAAA,GAAA,CAAM,EAAA,CAAG,CAAA,GAAI,EAAA,CAAG,CAAA,KAAM,CAAA;AAC5B,EAAA,MAAM,EAAA,GAAA,CAAM,EAAA,CAAG,CAAA,GAAI,EAAA,CAAG,CAAA,KAAM,CAAA;AAC5B,EAAA,OAAO,IAAA,CAAK,IAAA,CAAK,EAAA,GAAK,EAAA,GAAK,EAAE,CAAA;AAC9B;AAEA,SAAS,qBACR,gBAAA,EACA,aAAA,EACA,UAAA,EACA,CAAA,EACA,GACA,SAAA,EACS;AACT,EAAA,IAAI,SAAA,IAAa,GAAG,OAAO,CAAA;AAE3B,EAAA,IAAI,aAAA,GAAgB,CAAA;AACpB,EAAA,IAAI,WAAA,GAAc,CAAA;AAElB,EAAA,KAAA,MAAW,OAAO,UAAA,EAAY;AAC7B,IAAA,MAAM,IAAA,GAAO,iBAAiB,GAAG,CAAA;AACjC,IAAA,MAAM,IAAA,GAAO,cAAc,GAAG,CAAA;AAE9B,IAAA,IAAI,CAAC,IAAA,IAAQ,CAAC,IAAA,EAAM;AAGpB,IAAA,MAAM,QAAA,GAAW,iBAAA;AAAA,MAChB,EAAE,CAAA,EAAG,IAAA,CAAK,CAAA,GAAI,CAAA,EAAG,CAAA,EAAG,IAAA,CAAK,CAAA,GAAI,CAAA,EAAG,CAAA,EAAG,IAAA,CAAK,CAAA,EAAE;AAAA,MAC1C,EAAE,CAAA,EAAG,IAAA,CAAK,CAAA,GAAI,CAAA,EAAG,CAAA,EAAG,IAAA,CAAK,CAAA,GAAI,CAAA,EAAG,CAAA,EAAG,IAAA,CAAK,CAAA;AAAE,KAC3C;AAGA,IAAA,MAAM,WAAW,QAAA,GAAW,SAAA;AAC5B,IAAA,aAAA,IAAiB,QAAA;AACjB,IAAA,WAAA,EAAA;AAAA,EACD;AAEA,EAAA,IAAI,WAAA,KAAgB,GAAG,OAAO,CAAA;AAC9B,EAAA,OAAO,aAAA,GAAgB,WAAA;AACxB;AAEA,SAAS,wBAAA,CACR,eAAA,EACA,YAAA,EACA,SAAA,EACS;AACT,EAAA,IAAI,SAAA,IAAa,GAAG,OAAO,CAAA;AAC3B,EAAA,OAAO,IAAA,CAAK,GAAA,CAAI,eAAA,GAAkB,YAAY,CAAA,GAAI,SAAA;AACnD;AAEO,SAAS,wBAAA,GAA+C;AAC9D,EAAA,IAAI,QAAA,GAAqC,IAAA;AACzC,EAAA,MAAM,cAAA,uBAA0C,GAAA,EAAI;AAEpD,EAAA,SAAS,OAAA,CACR,SAAA,EACA,CAAA,EACA,CAAA,EAC6B;AAC7B,IAAA,MAAM,GAAA,GAAM,YAAY,GAAA,EAAI;AAC5B,IAAA,MAAM,OAAA,GAA6B;AAAA,MAClC,IAAA,EAAM,CAAA;AAAA,MACN,IAAA,EAAM,CAAA;AAAA,MACN,OAAA,EAAS,CAAA;AAAA,MACT,OAAA,EAAS,CAAA;AAAA,MACT,KAAA,EAAO;AAAA,KACR;AAGA,IAAA,IAAI,CAAC,QAAA,EAAU;AACd,MAAA,QAAA,GAAW;AAAA,QACV,SAAA,EAAW,UAAU,GAAA,CAAI,CAAC,OAAO,EAAE,GAAG,GAAE,CAAE,CAAA;AAAA,QAC1C,YAAY,EAAC;AAAA,QACb,SAAA,EAAW;AAAA,OACZ;AACA,MAAA,OAAO,OAAA,CAAQ,QAAQ,OAAO,CAAA;AAAA,IAC/B;AAEA,IAAA,MAAM,SAAA,GAAA,CAAa,GAAA,GAAM,QAAA,CAAS,SAAA,IAAa,GAAA;AAC/C,IAAA,IAAI,SAAA,IAAa,CAAA,IAAK,SAAA,GAAY,CAAA,EAAK;AAEtC,MAAA,QAAA,GAAW;AAAA,QACV,SAAA,EAAW,UAAU,GAAA,CAAI,CAAC,OAAO,EAAE,GAAG,GAAE,CAAE,CAAA;AAAA,QAC1C,YAAY,EAAC;AAAA,QACb,SAAA,EAAW;AAAA,OACZ;AACA,MAAA,cAAA,CAAe,KAAA,EAAM;AACrB,MAAA,OAAO,OAAA,CAAQ,QAAQ,OAAO,CAAA;AAAA,IAC/B;AAGA,IAAA,KAAA,MAAW,CAAC,OAAA,EAAS,UAAU,KAAK,MAAA,CAAO,OAAA,CAAQ,IAAI,CAAA,EAAG;AAEzD,MAAA,MAAM,eAAA,GAAkB,oBAAA;AAAA,QACvB,SAAA;AAAA,QACA,QAAA,CAAS,SAAA;AAAA,QACT,UAAA;AAAA,QACA,CAAA;AAAA,QACA,CAAA;AAAA,QACA;AAAA,OACD;AAGA,MAAA,MAAM,YAAA,GAAe,cAAA,CAAe,GAAA,CAAI,OAAO,CAAA,IAAK,CAAA;AACpD,MAAA,MAAM,YAAA,GAAe,wBAAA;AAAA,QACpB,eAAA;AAAA,QACA,YAAA;AAAA,QACA;AAAA,OACD;AAKA,MAAA,MAAM,iBAAiB,eAAA,GAAkB,EAAA;AACzC,MAAA,MAAM,qBAAqB,YAAA,GAAe,GAAA;AAI1C,MAAA,MAAM,SAAS,cAAA,GAAiB,kBAAA;AAEhC,MAAA,OAAA,CAAQ,OAAkC,CAAA,GAAI,MAAA;AAC9C,MAAA,cAAA,CAAe,GAAA,CAAI,SAAS,eAAe,CAAA;AAAA,IAC5C;AAGA,IAAA,QAAA,GAAW;AAAA,MACV,SAAA,EAAW,UAAU,GAAA,CAAI,CAAC,OAAO,EAAE,GAAG,GAAE,CAAE,CAAA;AAAA,MAC1C,YAAY,EAAC;AAAA,MACb,SAAA,EAAW;AAAA,KACZ;AAEA,IAAA,OAAO,OAAA,CAAQ,QAAQ,OAAO,CAAA;AAAA,EAC/B;AAEA,EAAA,SAAS,KAAA,GAAc;AACtB,IAAA,QAAA,GAAW,IAAA;AACX,IAAA,cAAA,CAAe,KAAA,EAAM;AAAA,EACtB;AAEA,EAAA,OAAO;AAAA,IACN,OAAA;AAAA,IACA;AAAA,GACD;AACD;;;AC5LO,IAAM,uBAAA,GAA4C;AAAA,EAUxD,MAAA,EAAQ;AAAA,IACP,qBAAA,EAAuB,EAAA;AAAA,IACvB,uBAAA,EAAyB,EAAA;AAAA,IACzB,cAAA,EAAgB,EAAA;AAAA,IAChB,kBAAA,EAAoB;AAAA,GACrB;AAAA,EAcA,GAAA,EAAK;AAAA,IACJ,kBAAA,EAAoB;AAAA;AAEtB,CAAA;;;ACtCA,IAAA,iCAAA,GAAA;AAAA,EACE,OAAA,EAAW,2BAAA;AAAA,EACX,YAAA,EAAgB,sBAAA;AAAA,EAChB,UAAA,EAAc;AAAA,IACZ,UAAA,EAAc;AAAA,MACZ,IAAA,EAAQ,uDAAA;AAAA,MACR,KAAA,EAAS;AAAA,KACX;AAAA,IACA,WAAA,EAAe;AAAA,MACb,IAAA,EAAQ,iEAAA;AAAA,MACR,KAAA,EAAS;AAAA,KACX;AAAA,IACA,QAAA,EAAY;AAAA,MACV,IAAA,EAAQ,0CAAA;AAAA,MACR,KAAA,EAAS;AAAA,KACX;AAAA,IACA,UAAA,EAAc;AAAA,MACZ,IAAA,EAAQ,2DAAA;AAAA,MACR,KAAA,EAAS;AAAA,KACX;AAAA,IACA,WAAA,EAAe;AAAA,MACb,IAAA,EAAQ,kDAAA;AAAA,MACR,KAAA,EAAS;AAAA,KACX;AAAA,IACA,QAAA,EAAY;AAAA,MACV,IAAA,EAAQ,0DAAA;AAAA,MACR,KAAA,EAAS;AAAA,KACX;AAAA,IACA,iBAAA,EAAqB;AAAA,MACnB,IAAA,EAAQ,6DAAA;AAAA,MACR,KAAA,EAAS;AAAA;AACX,GACF;AAAA,EACA,MAAA,EAAU;AAAA,IACR,eAAA,EAAmB;AAAA,MACjB,GAAA;AAAA,MACA,GAAA;AAAA,MACA,GAAA;AAAA,MACA,GAAA;AAAA,MACA;AAAA,KACF;AAAA,IACA,gBAAA,EAAoB;AAAA,MAClB,GAAA;AAAA,MACA,GAAA;AAAA,MACA,GAAA;AAAA,MACA,MAAA;AAAA,MACA;AAAA,KACF;AAAA,IACA,4BAAA,EAAgC;AAAA,GAClC;AAAA,EACA,KAAA,EAAS;AAAA,IACP,wBAAA,EAA4B;AAAA,MAC1B,WAAA,EAAe,iIAAA;AAAA,MACf,MAAA,EAAU;AAAA,QACR,MAAA;AAAA,QACA,OAAA;AAAA,QACA,MAAA;AAAA,QACA,SAAA;AAAA,QACA;AAAA,OACF;AAAA,MACA,UAAA,EAAc;AAAA,KAChB;AAAA,IACA,iBAAA,EAAqB;AAAA,MACnB,WAAA,EAAe;AAAA;AACjB,GACF;AAAA,EACA,eAAA,EAAmB;AAAA,IACjB,GAAA,EAAO;AAAA,MACL,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,GAAA,EAAO;AAAA,MACL,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,GAAA,EAAO;AAAA,MACL,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,GAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,GAAA,EAAO;AAAA,MACL,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,GAAA,EAAO;AAAA,MACL,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,EAAA;AAAA,MACZ,UAAA,EAAc,GAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,GAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,GAAA,EAAO;AAAA,MACL,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,EAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,GAAA,EAAO;AAAA,MACL,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,GAAA,EAAO;AAAA,MACL,UAAA,EAAc,GAAA;AAAA,MACd,WAAA,EAAe,GAAA;AAAA,MACf,QAAA,EAAY,GAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,EAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,GAAA;AAAA,MACf,QAAA,EAAY,GAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,EAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,EAAA;AAAA,MACZ,UAAA,EAAc,GAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,GAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,GAAA;AAAA,MACf,QAAA,EAAY,GAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,GAAA;AAAA,MACd,WAAA,EAAe,GAAA;AAAA,MACf,QAAA,EAAY,GAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,EAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,EAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,GAAA;AAAA,MACf,QAAA,EAAY,GAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,EAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,GAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,GAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,EAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,GAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,GAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,EAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,GAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,GAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,GAAA;AAAA,MACf,QAAA,EAAY,GAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,IAAA,EAAQ;AAAA,MACN,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,MAAA,EAAU;AAAA,MACR,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,MAAA,EAAU;AAAA,MACR,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,MAAA,EAAU;AAAA,MACR,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,EAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,MAAA,EAAU;AAAA,MACR,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,EAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,MAAA,EAAU;AAAA,MACR,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,MAAA,EAAU;AAAA,MACR,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,MAAA,EAAU;AAAA,MACR,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,MAAA,EAAU;AAAA,MACR,UAAA,EAAc,GAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,GAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,MAAA,EAAU;AAAA,MACR,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,MAAA,EAAU;AAAA,MACR,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,MAAA,EAAU;AAAA,MACR,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,MAAA,EAAU;AAAA,MACR,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,QAAA,EAAY;AAAA,MACV,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,QAAA,EAAY;AAAA,MACV,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,QAAA,EAAY;AAAA,MACV,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,GAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,QAAA,EAAY;AAAA,MACV,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,EAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,QAAA,EAAY;AAAA,MACV,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,QAAA,EAAY;AAAA,MACV,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,EAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,QAAA,EAAY;AAAA,MACV,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,QAAA,EAAY;AAAA,MACV,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA,KACvB;AAAA,IACA,QAAA,EAAY;AAAA,MACV,UAAA,EAAc,CAAA;AAAA,MACd,WAAA,EAAe,CAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,UAAA,EAAc,EAAA;AAAA,MACd,WAAA,EAAe,EAAA;AAAA,MACf,QAAA,EAAY,CAAA;AAAA,MACZ,iBAAA,EAAqB;AAAA;AACvB,GACF;AAAA,EACA,WAAA,EAAe;AAAA,IACb;AAAA,MACE,EAAA,EAAM,YAAA;AAAA,MACN,QAAA,EAAY;AAAA,QACV,MAAA;AAAA,QACA;AAAA,OACF;AAAA,MACA,SAAW,EAAC;AAAA,MACZ,WAAA,EAAe,+BAAA;AAAA,MACf,WAAA,EAAe;AAAA,QACb,UAAA,EAAc,EAAA;AAAA,QACd,WAAA,EAAe,EAAA;AAAA,QACf,QAAA,EAAY,EAAA;AAAA,QACZ,UAAA,EAAc,GAAA;AAAA,QACd,WAAA,EAAe,EAAA;AAAA,QACf,QAAA,EAAY,GAAA;AAAA,QACZ,iBAAA,EAAqB;AAAA,OACvB;AAAA,MACA,GAAA,EAAO;AAAA,QACL,aAAA;AAAA,QACA;AAAA,OACF;AAAA,MACA,kBAAA,EAAsB,gCAAA;AAAA,MACtB,oBAAA,EAAwB;AAAA,QACtB,2BAAA;AAAA,QACA,8CAAA;AAAA,QACA;AAAA;AACF,KACF;AAAA,IACA;AAAA,MACE,EAAA,EAAM,gBAAA;AAAA,MACN,QAAA,EAAY;AAAA,QACV;AAAA,OACF;AAAA,MACA,OAAA,EAAW;AAAA,QACT;AAAA,OACF;AAAA,MACA,WAAA,EAAe,iCAAA;AAAA,MACf,WAAA,EAAe;AAAA,QACb,UAAA,EAAc,CAAA;AAAA,QACd,WAAA,EAAe,EAAA;AAAA,QACf,QAAA,EAAY,EAAA;AAAA,QACZ,UAAA,EAAc,CAAA;AAAA,QACd,WAAA,EAAe,CAAA;AAAA,QACf,QAAA,EAAY,CAAA;AAAA,QACZ,iBAAA,EAAqB;AAAA,OACvB;AAAA,MACA,GAAA,EAAO;AAAA,QACL;AAAA,OACF;AAAA,MACA,kBAAA,EAAsB,8BAAA;AAAA,MACtB,oBAAA,EAAwB;AAAA,QACtB,+DAAA;AAAA,QACA,6CAAA;AAAA,QACA;AAAA;AACF,KACF;AAAA,IACA;AAAA,MACE,EAAA,EAAM,mBAAA;AAAA,MACN,QAAA,EAAY;AAAA,QACV,MAAA;AAAA,QACA;AAAA,OACF;AAAA,MACA,SAAW,EAAC;AAAA,MACZ,WAAA,EAAe,0CAAA;AAAA,MACf,WAAA,EAAe;AAAA,QACb,UAAA,EAAc,EAAA;AAAA,QACd,WAAA,EAAe,GAAA;AAAA,QACf,QAAA,EAAY,GAAA;AAAA,QACZ,UAAA,EAAc,EAAA;AAAA,QACd,WAAA,EAAe,EAAA;AAAA,QACf,QAAA,EAAY,CAAA;AAAA,QACZ,iBAAA,EAAqB;AAAA,OACvB;AAAA,MACA,GAAA,EAAO;AAAA,QACL;AAAA,OACF;AAAA,MACA,kBAAA,EAAsB,mDAAA;AAAA,MACtB,oBAAA,EAAwB;AAAA,QACtB,yCAAA;AAAA,QACA,iDAAA;AAAA,QACA;AAAA;AACF,KACF;AAAA,IACA;AAAA,MACE,EAAA,EAAM,oBAAA;AAAA,MACN,QAAA,EAAY;AAAA,QACV,KAAA;AAAA,QACA;AAAA,OACF;AAAA,MACA,SAAW,EAAC;AAAA,MACZ,WAAA,EAAe,kCAAA;AAAA,MACf,WAAA,EAAe;AAAA,QACb,UAAA,EAAc,EAAA;AAAA,QACd,WAAA,EAAe,GAAA;AAAA,QACf,QAAA,EAAY,GAAA;AAAA,QACZ,UAAA,EAAc,EAAA;AAAA,QACd,WAAA,EAAe,EAAA;AAAA,QACf,QAAA,EAAY,CAAA;AAAA,QACZ,iBAAA,EAAqB;AAAA,OACvB;AAAA,MACA,GAAA,EAAO;AAAA,QACL;AAAA,OACF;AAAA,MACA,kBAAA,EAAsB,2BAAA;AAAA,MACtB,oBAAA,EAAwB;AAAA,QACtB,yCAAA;AAAA,QACA,iDAAA;AAAA,QACA;AAAA;AACF,KACF;AAAA,IACA;AAAA,MACE,EAAA,EAAM,cAAA;AAAA,MACN,QAAA,EAAY;AAAA,QACV;AAAA,OACF;AAAA,MACA,SAAW,EAAC;AAAA,MACZ,WAAA,EAAe,0CAAA;AAAA,MACf,WAAA,EAAe;AAAA,QACb,UAAA,EAAc,EAAA;AAAA,QACd,WAAA,EAAe,EAAA;AAAA,QACf,QAAA,EAAY,GAAA;AAAA,QACZ,UAAA,EAAc,EAAA;AAAA,QACd,WAAA,EAAe,EAAA;AAAA,QACf,QAAA,EAAY,CAAA;AAAA,QACZ,iBAAA,EAAqB;AAAA,OACvB;AAAA,MACA,GAAA,EAAO;AAAA,QACL;AAAA,OACF;AAAA,MACA,kBAAA,EAAsB,wCAAA;AAAA,MACtB,oBAAA,EAAwB;AAAA,QACtB,yCAAA;AAAA,QACA,iDAAA;AAAA,QACA;AAAA;AACF,KACF;AAAA,IACA;AAAA,MACE,EAAA,EAAM,iBAAA;AAAA,MACN,QAAA,EAAY;AAAA,QACV,KAAA;AAAA,QACA;AAAA,OACF;AAAA,MACA,SAAW,EAAC;AAAA,MACZ,WAAA,EAAe,oCAAA;AAAA,MACf,WAAA,EAAe;AAAA,QACb,UAAA,EAAc,GAAA;AAAA,QACd,WAAA,EAAe,GAAA;AAAA,QACf,QAAA,EAAY,GAAA;AAAA,QACZ,UAAA,EAAc,EAAA;AAAA,QACd,WAAA,EAAe,EAAA;AAAA,QACf,QAAA,EAAY,EAAA;AAAA,QACZ,iBAAA,EAAqB;AAAA,OACvB;AAAA,MACA,GAAA,EAAO;AAAA,QACL;AAAA,OACF;AAAA,MACA,kBAAA,EAAsB,iCAAA;AAAA,MACtB,oBAAA,EAAwB;AAAA,QACtB,qCAAA;AAAA,QACA,yCAAA;AAAA,QACA;AAAA;AACF,KACF;AAAA,IACA;AAAA,MACE,EAAA,EAAM,WAAA;AAAA,MACN,QAAA,EAAY;AAAA,QACV,KAAA;AAAA,QACA;AAAA,OACF;AAAA,MACA,SAAW,EAAC;AAAA,MACZ,WAAA,EAAe,0CAAA;AAAA,MACf,WAAA,EAAe;AAAA,QACb,UAAA,EAAc,GAAA;AAAA,QACd,WAAA,EAAe,CAAA;AAAA,QACf,QAAA,EAAY,GAAA;AAAA,QACZ,UAAA,EAAc,EAAA;AAAA,QACd,WAAA,EAAe,EAAA;AAAA,QACf,QAAA,EAAY,CAAA;AAAA,QACZ,iBAAA,EAAqB;AAAA,OACvB;AAAA,MACA,GAAA,EAAO;AAAA,QACL;AAAA,OACF;AAAA,MACA,kBAAA,EAAsB,gCAAA;AAAA,MACtB,oBAAA,EAAwB;AAAA,QACtB,mDAAA;AAAA,QACA,4BAAA;AAAA,QACA;AAAA;AACF,KACF;AAAA,IACA;AAAA,MACE,EAAA,EAAM,aAAA;AAAA,MACN,QAAA,EAAY;AAAA,QACV,MAAA;AAAA,QACA;AAAA,OACF;AAAA,MACA,SAAW,EAAC;AAAA,MACZ,WAAA,EAAe,qCAAA;AAAA,MACf,WAAA,EAAe;AAAA,QACb,UAAA,EAAc,EAAA;AAAA,QACd,WAAA,EAAe,CAAA;AAAA,QACf,QAAA,EAAY,EAAA;AAAA,QACZ,UAAA,EAAc,EAAA;AAAA,QACd,WAAA,EAAe,EAAA;AAAA,QACf,QAAA,EAAY,CAAA;AAAA,QACZ,iBAAA,EAAqB;AAAA,OACvB;AAAA,MACA,GAAA,EAAO;AAAA,QACL;AAAA,OACF;AAAA,MACA,kBAAA,EAAsB,iCAAA;AAAA,MACtB,oBAAA,EAAwB;AAAA,QACtB,gCAAA;AAAA,QACA,mCAAA;AAAA,QACA;AAAA;AACF,KACF;AAAA,IACA;AAAA,MACE,EAAA,EAAM,oBAAA;AAAA,MACN,QAAA,EAAY;AAAA,QACV;AAAA,OACF;AAAA,MACA,SAAW,EAAC;AAAA,MACZ,WAAA,EAAe,+CAAA;AAAA,MACf,WAAA,EAAe;AAAA,QACb,UAAA,EAAc,GAAA;AAAA,QACd,WAAA,EAAe,EAAA;AAAA,QACf,QAAA,EAAY,GAAA;AAAA,QACZ,UAAA,EAAc,EAAA;AAAA,QACd,WAAA,EAAe,EAAA;AAAA,QACf,QAAA,EAAY,CAAA;AAAA,QACZ,iBAAA,EAAqB;AAAA,OACvB;AAAA,MACA,GAAA,EAAO;AAAA,QACL;AAAA,OACF;AAAA,MACA,kBAAA,EAAsB,0CAAA;AAAA,MACtB,oBAAA,EAAwB;AAAA,QACtB,4BAAA;AAAA,QACA,gCAAA;AAAA,QACA;AAAA;AACF;AACF,GACF;AAAA,EACA,yBAAA,EAA6B;AAAA,IAC3B,UAAA,EAAc;AAAA,MACZ,MAAA,EAAU,0DAAA;AAAA,MACV,SAAA,EAAa;AAAA,QACX,yCAAA;AAAA,QACA,iDAAA;AAAA,QACA;AAAA;AACF,KACF;AAAA,IACA,WAAA,EAAe;AAAA,MACb,MAAA,EAAU,sDAAA;AAAA,MACV,SAAA,EAAa;AAAA,QACX,gCAAA;AAAA,QACA,mCAAA;AAAA,QACA;AAAA;AACF,KACF;AAAA,IACA,QAAA,EAAY;AAAA,MACV,MAAA,EAAU,wDAAA;AAAA,MACV,SAAA,EAAa;AAAA,QACX,qCAAA;AAAA,QACA,yCAAA;AAAA,QACA;AAAA;AACF,KACF;AAAA,IACA,WAAA,EAAe;AAAA,MACb,MAAA,EAAU,yDAAA;AAAA,MACV,SAAA,EAAa;AAAA,QACX,8BAAA;AAAA,QACA,wCAAA;AAAA,QACA;AAAA;AACF,KACF;AAAA,IACA,UAAA,EAAc;AAAA,MACZ,MAAA,EAAU,oDAAA;AAAA,MACV,SAAA,EAAa;AAAA,QACX,+BAAA;AAAA,QACA,kCAAA;AAAA,QACA;AAAA;AACF,KACF;AAAA,IACA,iBAAA,EAAqB;AAAA,MACnB,MAAA,EAAU,sDAAA;AAAA,MACV,SAAA,EAAa;AAAA,QACX,+DAAA;AAAA,QACA,6CAAA;AAAA,QACA;AAAA;AACF,KACF;AAAA,IACA,QAAA,EAAY;AAAA,MACV,MAAA,EAAU,2DAAA;AAAA,MACV,SAAA,EAAa;AAAA,QACX,2BAAA;AAAA,QACA,8CAAA;AAAA,QACA;AAAA;AACF;AACF,GACF;AAAA,EACA,gBAAA,EAAoB;AAAA,IAClB,gDAAA;AAAA,IACA,sFAAA;AAAA,IACA,yFAAA;AAAA,IACA,gEAAA;AAAA,IACA,2FAAA;AAAA,IACA;AAAA,GACF;AAAA,EACA,KAAA,EAAS;AACX,CAAA;;;AC11BO,IAAM,iBAAA,GAAgC;;;ACG7C,SAAS,sBAAA,CAAuB,KAAA,EAAe,IAAA,GAAgB,IAAA,EAAc;AAC5E,EAAA,IAAI,CAAC,IAAA,EAAM;AACV,IAAA,OAAO,CAAA;AAAA,EACR;AAEA,EAAA,IAAI,KAAA,IAAS,KAAK,OAAO,CAAA;AACzB,EAAA,IAAI,KAAA,IAAS,KAAK,OAAO,GAAA;AACzB,EAAA,IAAI,KAAA,IAAS,KAAK,OAAO,GAAA;AACzB,EAAA,IAAI,KAAA,IAAS,KAAK,OAAO,GAAA;AACzB,EAAA,IAAI,KAAA,IAAS,KAAK,OAAO,GAAA;AACzB,EAAA,OAAO,CAAA;AACR;AAEO,SAAS,yBACf,KAAA,EACqB;AACrB,EAAA,IAAI,CAAC,KAAA,EAAO;AACX,IAAA,MAAM,IAAI,KAAA;AAAA,MACT;AAAA,KACD;AAAA,EACD;AAEA,EAAA,IAAI,CAAC,MAAM,eAAA,EAAiB;AAC3B,IAAA,MAAM,IAAI,KAAA;AAAA,MACT;AAAA,KACD;AAAA,EACD;AAEA,EAAA,IAAI,CAAC,MAAM,WAAA,EAAa;AACvB,IAAA,MAAM,IAAI,KAAA;AAAA,MACT;AAAA,KACD;AAAA,EACD;AAEA,EAAA,IAAI,CAAC,MAAM,UAAA,EAAY;AACtB,IAAA,MAAM,IAAI,KAAA;AAAA,MACT;AAAA,KACD;AAAA,EACD;AAEA,EAAA,MAAM,UAAU,KAAA,CAAM,eAAA;AACtB,EAAA,MAAM,SAAS,KAAA,CAAM,WAAA;AACrB,EAAA,MAAM,cAAA,GAAiB,MAAA,CAAO,IAAA,CAAK,KAAA,CAAM,UAAU,CAAA;AACnD,EAAA,MAAM,UAAA,GAAa,KAAA,CAAM,yBAAA,IAA6B,EAAC;AAEvD,EAAA,SAASA,SAAQ,YAAA,EAA+C;AAC/D,IAAA,MAAM,GAAA,GAAM,YAAA,CAAa,GAAA,IAAO,EAAC;AACjC,IAAA,MAAM,IAAA,GAAO,YAAA,CAAa,IAAA,IAAQ,EAAC;AAEnC,IAAA,MAAM,SAAiC,EAAC;AACxC,IAAA,KAAA,MAAW,OAAO,cAAA,EAAgB;AACjC,MAAA,MAAA,CAAO,GAAG,CAAA,GAAI,CAAA;AAAA,IACf;AAEA,IAAA,MAAM,cAAwB,EAAC;AAE/B,IAAA,KAAA,MAAW,CAAC,IAAA,EAAM,MAAM,KAAK,MAAA,CAAO,OAAA,CAAQ,GAAG,CAAA,EAAG;AACjD,MAAA,MAAM,EAAA,GAAK,sBAAA,CAAuB,MAAA,EAAQ,IAAI,CAAA;AAC9C,MAAA,IAAI,EAAA,GAAK,CAAA,IAAK,IAAA,IAAQ,OAAA,EAAS;AAC9B,QAAA,WAAA,CAAY,KAAK,IAAI,CAAA;AACrB,QAAA,MAAM,SAAA,GAAY,OAAA,CAAQ,IAAI,CAAA,IAAK,EAAC;AACpC,QAAA,KAAA,MAAW,CAAC,GAAA,EAAK,MAAM,KAAK,MAAA,CAAO,OAAA,CAAQ,SAAS,CAAA,EAAG;AACtD,UAAA,MAAA,CAAO,GAAG,CAAA,GAAA,CAAK,MAAA,CAAO,GAAG,CAAA,IAAK,KAAK,EAAA,GAAK,MAAA;AAAA,QACzC;AAAA,MACD;AAAA,IACD;AAEA,IAAA,MAAM,cAAwB,EAAC;AAC/B,IAAA,MAAM,IAAA,GAAO,KAAK,IAAA,IAAQ,QAAA;AAC1B,IAAA,IAAI,IAAA,KAAS,cAAA,EAAgB,WAAA,CAAY,IAAA,CAAK,QAAQ,CAAA;AAEtD,IAAA,MAAM,KAAA,GAAQ,KAAK,UAAA,IAAc,CAAA;AACjC,IAAA,IAAI,KAAA,GAAQ,EAAA,EAAI,WAAA,CAAY,IAAA,CAAK,QAAQ,CAAA;AAAA,SAAA,IAChC,KAAA,GAAQ,GAAA,EAAK,WAAA,CAAY,IAAA,CAAK,QAAQ,CAAA;AAE/C,IAAA,KAAA,MAAW,SAAS,WAAA,EAAa;AAChC,MAAA,IAAI,SAAS,OAAA,EAAS;AACrB,QAAA,WAAA,CAAY,KAAK,KAAK,CAAA;AACtB,QAAA,MAAM,SAAA,GAAY,OAAA,CAAQ,KAAK,CAAA,IAAK,EAAC;AACrC,QAAA,KAAA,MAAW,CAAC,GAAA,EAAK,MAAM,KAAK,MAAA,CAAO,OAAA,CAAQ,SAAS,CAAA,EAAG;AACtD,UAAA,MAAA,CAAO,GAAG,CAAA,GAAA,CAAK,MAAA,CAAO,GAAG,CAAA,IAAK,KAAK,CAAA,GAAM,MAAA;AAAA,QAC1C;AAAA,MACD;AAAA,IACD;AAEA,IAAA,MAAM,kBAA8B,EAAC;AACrC,IAAA,KAAA,MAAW,SAAS,MAAA,EAAQ;AAC3B,MAAA,MAAM,WAAA,GAAc,MAAM,QAAA,CAAS,KAAA;AAAA,QAAM,CAAC,GAAA,KACzC,WAAA,CAAY,QAAA,CAAS,GAAG;AAAA,OACzB;AACA,MAAA,MAAM,aACL,KAAA,CAAM,OAAA,IAAW,KAAA,CAAM,OAAA,CAAQ,SAAS,CAAA,GACrC,KAAA,CAAM,OAAA,CAAQ,IAAA,CAAK,CAAC,MAAA,KAAW,WAAA,CAAY,QAAA,CAAS,MAAM,CAAC,CAAA,GAC3D,KAAA;AAEJ,MAAA,IAAI,WAAA,IAAe,CAAC,UAAA,EAAY;AAE/B,QAAA,IAAI,KAAA,CAAM,GAAA,IAAO,KAAA,CAAM,GAAA,CAAI,SAAS,CAAA,EAAG;AACtC,UAAA,eAAA,CAAgB,IAAA,CAAK,MAAM,GAAG,CAAA;AAAA,QAC/B,CAAA,MAAA,IAAW,MAAM,EAAA,EAAI;AACpB,UAAA,eAAA,CAAgB,IAAA,CAAK,CAAC,KAAA,CAAM,EAAE,CAAC,CAAA;AAAA,QAChC;AACA,QAAA,KAAA,MAAW,CAAC,GAAA,EAAK,GAAG,CAAA,IAAK,MAAA,CAAO,QAAQ,KAAA,CAAM,WAAA,IAAe,EAAE,CAAA,EAAG;AACjE,UAAA,MAAA,CAAO,GAAG,CAAA,GAAA,CAAK,MAAA,CAAO,GAAG,KAAK,CAAA,IAAK,GAAA;AAAA,QACpC;AAAA,MACD;AAAA,IACD;AAEA,IAAA,MAAM,cAAsC,EAAC;AAC7C,IAAA,KAAA,MAAW,CAAC,CAAA,EAAG,CAAC,KAAK,MAAA,CAAO,OAAA,CAAQ,MAAM,CAAA,EAAG;AAC5C,MAAA,WAAA,CAAY,CAAC,IAAI,IAAA,CAAK,GAAA,CAAI,MAAM,IAAA,CAAK,GAAA,CAAI,GAAA,EAAK,CAAC,CAAC,CAAA;AAAA,IACjD;AAEA,IAAA,IAAI,MAAA,GAAS,cAAA,CAAe,CAAC,CAAA,IAAK,YAAA;AAClC,IAAA,IAAI,SAAS,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,MAAM,KAAK,CAAC,CAAA;AAC9C,IAAA,KAAA,MAAW,CAAC,CAAA,EAAG,CAAC,KAAK,MAAA,CAAO,OAAA,CAAQ,WAAW,CAAA,EAAG;AACjD,MAAA,MAAM,GAAA,GAAM,IAAA,CAAK,GAAA,CAAI,CAAC,CAAA;AACtB,MAAA,IAAI,MAAM,MAAA,EAAQ;AACjB,QAAA,MAAA,GAAS,GAAA;AACT,QAAA,MAAA,GAAS,CAAA;AAAA,MACV;AAAA,IACD;AAEA,IAAA,MAAM,UAAA,GAAa,UAAA,CAAW,MAAM,CAAA,IAAK;AAAA,MACxC,MAAA,EAAQ,SAAA;AAAA,MACR,WAAW;AAAC,KACb;AAEA,IAAA,OAAO;AAAA,MACN,kBAAA,EAAoB,MAAA;AAAA,MACpB,gBAAgB,IAAA,CAAK,KAAA,CAAM,WAAA,CAAY,MAAM,KAAK,CAAC,CAAA;AAAA,MACnD,aAAA,EAAe,eAAA;AAAA,MACf,MAAA,EAAQ,WAAA;AAAA,MACR,mBAAA,EAAqB,CAAC,UAAA,CAAW,MAAM,CAAA;AAAA,MACvC,WAAW,UAAA,CAAW;AAAA,KACvB;AAAA,EACD;AAEA,EAAA,OAAO;AAAA,IACN,OAAA,EAAAA;AAAA,GACD;AACD;;;AC3IA,IAAM,UAAA,GAAa,GAAA;AACnB,IAAM,iBAAA,GAAsC,CAAC,EAAA,EAAI,GAAG,CAAA;AACpD,IAAM,QAAA,GAAW,CAAA;AACjB,IAAM,cAAA,GAAmC,CAAC,GAAA,EAAK,GAAG,CAAA;AAE3C,SAAS,kBAAkB,MAAA,EAA0B;AAC3D,EAAA,MAAM,YAAA,GAAe,MAAA,CAAO,MAAA,EAAQ,kBAAA,IAAsB,GAAA;AAS1D,EAAA,SAAS,QAAQ,SAAA,EAAgD;AAChE,IAAA,MAAM,IAAA,GAAO,UAAU,QAAQ,CAAA;AAC/B,IAAA,MAAM,OAAA,GAAU,SAAA,CAAU,cAAA,CAAe,CAAC,CAAC,CAAA;AAC3C,IAAA,MAAM,QAAA,GAAW,SAAA,CAAU,cAAA,CAAe,CAAC,CAAC,CAAA;AAE5C,IAAA,IAAI,CAAC,IAAA,IAAQ,CAAC,OAAA,IAAW,CAAC,QAAA,EAAU;AACnC,MAAA,OAAO;AAAA,QACN,SAAA,EAAW,KAAA;AAAA,QACX,SAAA,EAAW,CAAA;AAAA,QACX,MAAA,EAAQ;AAAA,OACT;AAAA,IACD;AAEA,IAAA,MAAM,SAAA,GAAY,QAAA,CAAS,CAAA,GAAI,OAAA,CAAQ,CAAA;AACvC,IAAA,IAAI,IAAA,CAAK,GAAA,CAAI,SAAS,CAAA,GAAI,IAAA,EAAM;AAC/B,MAAA,OAAO;AAAA,QACN,SAAA,EAAW,KAAA;AAAA,QACX,SAAA,EAAW,CAAA;AAAA,QACX,MAAA,EAAQ;AAAA,OACT;AAAA,IACD;AAEA,IAAA,MAAM,YAAA,GAAA,CAAgB,IAAA,CAAK,CAAA,GAAI,OAAA,CAAQ,CAAA,IAAK,SAAA;AAC5C,IAAA,MAAM,gBAAA,GAAmB,IAAA,CAAK,GAAA,CAAI,YAAA,GAAe,GAAG,CAAA,GAAI,GAAA;AAExD,IAAA,MAAM,KAAA,GAAQ,UAAU,UAAU,CAAA;AAClC,IAAA,MAAM,SAAA,GAAY,SAAA,CAAU,iBAAA,CAAkB,CAAC,CAAC,CAAA;AAChD,IAAA,MAAM,OAAA,GAAU,SAAA,CAAU,iBAAA,CAAkB,CAAC,CAAC,CAAA;AAE9C,IAAA,IAAI,CAAC,KAAA,IAAS,CAAC,SAAA,IAAa,CAAC,OAAA,EAAS;AACrC,MAAA,OAAO;AAAA,QACN,SAAA,EAAW,KAAA;AAAA,QACX,SAAA,EAAW,CAAA;AAAA,QACX,MAAA,EAAQ;AAAA,OACT;AAAA,IACD;AAEA,IAAA,MAAM,SAAA,GAAY,OAAA,CAAQ,CAAA,GAAI,SAAA,CAAU,CAAA;AAExC,IAAA,MAAM,SAAA,GACL,IAAA,CAAK,GAAA,CAAI,SAAS,CAAA,GAAI,OAAO,GAAA,GAAA,CAAO,KAAA,CAAM,CAAA,GAAI,SAAA,CAAU,CAAA,IAAK,SAAA;AAE9D,IAAA,MAAM,aAAA,GAAgB,IAAA,CAAK,GAAA,CAAI,SAAA,GAAY,GAAG,CAAA,GAAI,GAAA;AAElD,IAAA,MAAM,cAAA,GAAiB,mBAAmB,aAAA,GAAgB,GAAA;AAE1D,IAAA,MAAM,QAAQ,KAAA,CAAM,CAAA;AACpB,IAAA,MAAM,UAAA,GAAA,CAAc,SAAA,CAAU,CAAA,GAAI,OAAA,CAAQ,CAAA,IAAK,CAAA;AAC/C,IAAA,MAAM,YAAA,GAAA,CAAgB,QAAQ,UAAA,IAAc,GAAA;AAE5C,IAAA,IAAI,MAAA,GAAqB,QAAA;AACzB,IAAA,IAAI,iBAAiB,YAAA,EAAc;AAClC,MAAA,IAAI,eAAe,GAAA,EAAK;AACvB,QAAA,MAAA,GAAS,aAAA;AAAA,MACV,CAAA,MAAA,IAAW,eAAe,EAAA,EAAI;AAC7B,QAAA,MAAA,GAAS,eAAA;AAAA,MACV,CAAA,MAAO;AACN,QAAA,MAAA,GAAS,SAAA;AAAA,MACV;AAEA,MAAA,OAAO;AAAA,QACN,SAAA,EAAW,KAAA;AAAA,QACX,SAAA,EAAW,cAAA;AAAA,QACX;AAAA,OACD;AAAA,IACD;AAEA,IAAA,OAAO;AAAA,MACN,SAAA,EAAW,IAAA;AAAA,MACX,SAAA,EAAW,cAAA;AAAA,MACX,MAAA,EAAQ;AAAA,KACT;AAAA,EACD;AAEA,EAAA,OAAO;AAAA,IACN;AAAA,GACD;AACD;;;AChEA,SAAS,4BACR,QAAA,EACqB;AAErB,EAAA,IAAI,CAAC,KAAA,CAAM,OAAA,CAAQ,QAAA,CAAS,aAAa,CAAA,EAAG;AAC3C,IAAA,OAAA,CAAQ,IAAA,CAAK,gCAAA,EAAkC,QAAA,CAAS,aAAa,CAAA;AACrE,IAAA,OAAO;AAAA,MACN,eAAe;AAAC,KACjB;AAAA,EACD;AAEA,EAAA,MAAM,aAAA,GAAmC,QAAA,CAAS,aAAA,CAChD,MAAA,CAAO,CAAC,SAAS,KAAA,CAAM,OAAA,CAAQ,IAAI,CAAC,CAAA,CACpC,GAAA;AAAA,IAAI,CAAC,IAAA,KACL,IAAA,CAAK,GAAA,CAAI,CAAC,KAAA,MAAW;AAAA,MACpB,GAAG,KAAA,CAAM,CAAA;AAAA,MACT,GAAG,KAAA,CAAM,CAAA;AAAA,MACT,GAAG,KAAA,CAAM;AAAA,KACV,CAAE;AAAA,GACH;AAED,EAAA,IAAI,eAAA;AACJ,EAAA,IAAI,SAAS,eAAA,EAAiB;AAE7B,IAAA,IAAI,CAAC,KAAA,CAAM,OAAA,CAAQ,QAAA,CAAS,eAAe,CAAA,EAAG;AAC7C,MAAA,OAAA,CAAQ,IAAA;AAAA,QACP,kCAAA;AAAA,QACA,OAAO,QAAA,CAAS,eAAA;AAAA,QAChB,QAAA,CAAS;AAAA,OACV;AAAA,IACD,CAAA,MAAO;AACN,MAAA,IAAI;AAGH,QAAA,eAAA,GAAkB,QAAA,CAAS,eAAA,CACzB,MAAA,CAAO,CAAC,cAAA,KAAmB;AAE3B,UAAA,MAAM,OAAA,GACL,cAAA,IACA,OAAO,cAAA,KAAmB,QAAA,IAC1B,gBAAgB,cAAA,IAChB,KAAA,CAAM,OAAA,CAAQ,cAAA,CAAe,UAAU,CAAA;AACxC,UAAA,IAAI,CAAC,OAAA,IAAW,OAAA,CAAQ,GAAA,CAAI,aAAa,aAAA,EAAe;AACvD,YAAA,OAAA,CAAQ,IAAA;AAAA,cACP,oDAAA;AAAA,cACA,OAAO,cAAA;AAAA,cACP;AAAA,aACD;AAAA,UACD;AACA,UAAA,OAAO,OAAA;AAAA,QACR,CAAC,CAAA,CACA,GAAA;AAAA,UAAI,CAAC,cAAA,KACL,cAAA,CAAe,UAAA,CAAW,GAAA,CAAI,CAAC,UAAA,MAAgB;AAAA,YAC9C,eAAe,UAAA,CAAW,YAAA;AAAA,YAC1B,OAAO,UAAA,CAAW;AAAA,WACnB,CAAE;AAAA,SACH;AAAA,MACF,SAAS,KAAA,EAAO;AACf,QAAA,OAAA,CAAQ,KAAA,CAAM,qCAAqC,KAAK,CAAA;AAExD,QAAA,eAAA,GAAkB,MAAA;AAAA,MACnB;AAAA,IACD;AAAA,EACD;AAEA,EAAA,MAAM,SAAA,GAAgC;AAAA,IACrC;AAAA,GACD;AACA,EAAA,IAAI,eAAA,EAAiB;AACpB,IAAA,SAAA,CAAU,eAAA,GAAkB,eAAA;AAAA,EAC7B;AACA,EAAA,OAAO,SAAA;AACR;AAEO,SAAS,qBAAA,CACf,QAAA,EACA,SAAA,GAAoB,8BAAA,EACF;AAClB,EAAA,MAAM,WAAA,GAAc,IAAA;AAEpB,EAAA,SAAS,YAAA,CACR,KAAA,EACA,SAAA,GAAoB,IAAA,CAAK,KAAI,EACD;AAC5B,IAAA,IAAI;AACH,MAAA,IAAI,CAAC,QAAA,IAAY,CAAC,WAAA,EAAa;AAC9B,QAAA,OAAA,CAAQ,KAAK,kCAAkC,CAAA;AAC/C,QAAA,OAAO,IAAA;AAAA,MACR;AAEA,MAAA,MAAM,eAAA,GAAkB,QAAA,CAAS,cAAA,CAAe,KAAA,EAAO,SAAS,CAAA;AAGhE,MAAA,IAAI,CAAC,eAAA,EAAiB;AACrB,QAAA,OAAO,IAAA;AAAA,MACR;AAGA,MAAA,IAAI,OAAO,WAAW,WAAA,EAAa;AAClC,QAAA,MAAM,GAAA,GAAM,MAAA;AACZ,QAAA,IAAI,CAAC,IAAI,eAAA,EAAiB;AACzB,UAAA,GAAA,CAAI,eAAA,GAAkB,IAAA;AACtB,UAAA,MAAM,eAAA,GAAkB,eAAA,CAAgB,eAAA,GAAkB,CAAC,CAAA;AAC3D,UAAA,OAAA,CAAQ,IAAI,6BAAA,EAA+B;AAAA,YAC1C,gBAAA,EAAkB,CAAC,CAAC,eAAA,CAAgB,aAAA;AAAA,YACpC,mBAAA,EAAqB,MAAM,OAAA,CAAQ,eAAA,CAAgB,aAAa,CAAA,GAC7D,eAAA,CAAgB,cAAc,MAAA,GAC9B,CAAA;AAAA,YACH,kBAAA,EAAoB,CAAC,CAAC,eAAA,CAAgB,eAAA;AAAA,YACtC,uBAAuB,KAAA,CAAM,OAAA;AAAA,cAC5B,eAAA,CAAgB;AAAA,aACjB,GACG,eAAA,CAAgB,eAAA,CAAgB,MAAA,GAChC,CAAA;AAAA,YACH,mBAAA,EAAqB,eAAA,GAClB,OAAO,eAAA,GACP,KAAA;AAAA,YACH,mBAAA,EACC,mBAAmB,OAAO,eAAA,KAAoB,WAC3C,MAAA,CAAO,IAAA,CAAK,eAAe,CAAA,GAC3B,EAAC;AAAA,YACL,eACC,eAAA,IAAmB,OAAO,eAAA,KAAoB,QAAA,GAC3C,gBAAgB,eAAA,GAChB,KAAA;AAAA,YACJ,cAAA,EACC,eAAA,IACA,OAAO,eAAA,KAAoB,YAC3B,YAAA,IAAgB,eAAA,GACb,KAAA,CAAM,OAAA,CAAQ,gBAAgB,UAAU,CAAA,GACvC,OAAA,GACA,OAAO,gBAAgB,UAAA,GACxB,KAAA;AAAA,YACJ,gBAAA,EACC,eAAA,IACA,OAAO,eAAA,KAAoB,YAC3B,YAAA,IAAgB,eAAA,IAChB,KAAA,CAAM,OAAA,CAAQ,eAAA,CAAgB,UAAU,CAAA,GACrC,eAAA,CAAgB,WAAW,MAAA,GAC3B,CAAA;AAAA,YACJ,MAAA,EAAQ;AAAA,WACR,CAAA;AAAA,QACF;AAAA,MACD;AAGA,MAAA,IACC,CAAC,eAAA,CAAgB,aAAA,IACjB,CAAC,KAAA,CAAM,OAAA,CAAQ,eAAA,CAAgB,aAAa,CAAA,IAC5C,eAAA,CAAgB,aAAA,CAAc,MAAA,KAAW,CAAA,EACxC;AACD,QAAA,OAAO,IAAA;AAAA,MACR;AAEA,MAAA,OAAO,4BAA4B,eAAe,CAAA;AAAA,IACnD,SAAS,KAAA,EAAO;AACf,MAAA,OAAA,CAAQ,KAAA,CAAM,6BAA6B,KAAK,CAAA;AAChD,MAAA,IAAI,iBAAiB,KAAA,EAAO;AAC3B,QAAA,OAAA,CAAQ,KAAA,CAAM,gBAAA,EAAkB,KAAA,CAAM,OAAA,EAAS,MAAM,KAAK,CAAA;AAAA,MAC3D;AACA,MAAA,OAAO,IAAA;AAAA,IACR;AAAA,EACD;AAEA,EAAA,SAAS,aAAA,GAAyB;AACjC,IAAA,OAAO,WAAA;AAAA,EACR;AAEA,EAAA,SAAS,YAAA,GAAuB;AAC/B,IAAA,OAAO,SAAA;AAAA,EACR;AAEA,EAAA,OAAO;AAAA,IACN,YAAA;AAAA,IACA,aAAA;AAAA,IACA;AAAA,GACD;AACD;;;AClNA,IAAM,WAAA,GAAc,EAAA;AACpB,IAAM,cAAA,GAAiB,EAAA;AAEvB,IAAMC,SAAAA,GAAW,CAAA;AACjB,IAAM,QAAA,GAAW,GAAA;AAEV,SAAS,4BAA4B,MAAA,EAA0B;AACrE,EAAA,MAAM,SAAA,GAAY,MAAA,CAAO,GAAA,EAAK,kBAAA,IAAsB,GAAA;AAEpD,EAAA,SAAS,WAAW,SAAA,EAAqC;AACxD,IAAA,MAAM,MAAA,GAAS,UAAU,WAAW,CAAA;AACpC,IAAA,MAAM,SAAA,GAAY,UAAU,cAAc,CAAA;AAE1C,IAAA,IAAI,CAAC,MAAA,IAAU,CAAC,SAAA,EAAW,OAAO,KAAA;AAElC,IAAA,MAAM,OAAA,GAAU,iBAAA,CAAkB,MAAA,EAAQ,SAAS,CAAA;AAEnD,IAAA,MAAM,IAAA,GAAO,UAAUA,SAAQ,CAAA;AAC/B,IAAA,MAAM,IAAA,GAAO,UAAU,QAAQ,CAAA;AAE/B,IAAA,IAAI,CAAC,IAAA,IAAQ,CAAC,IAAA,EAAM,OAAO,KAAA;AAE3B,IAAA,MAAM,WAAA,GAAc,iBAAA,CAAkB,IAAA,EAAM,IAAI,CAAA;AAEhD,IAAA,IAAI,WAAA,KAAgB,GAAG,OAAO,KAAA;AAE9B,IAAA,MAAM,eAAe,OAAA,GAAU,WAAA;AAE/B,IAAA,OAAO,YAAA,GAAe,SAAA;AAAA,EACvB;AAEA,EAAA,OAAO;AAAA,IACN;AAAA,GACD;AACD;;;ACoBA,eAAe,SAAA,CACd,QACA,MAAA,EACgB;AAChB,EAAA,IAAI;AACH,IAAA,MAAM,MAAM,MAAA,EAAQ;AAAA,MACnB,MAAA,EAAQ,MAAA;AAAA,MACR,OAAA,EAAS;AAAA,QACR,cAAA,EAAgB;AAAA,OACjB;AAAA,MACA,IAAA,EAAM,IAAA,CAAK,SAAA,CAAU,MAAM;AAAA,KAC3B,CAAA;AAAA,EACF,SAAS,KAAA,EAAO;AAEf,IAAA,OAAA,CAAQ,IAAA,CAAK,yDAAsD,KAAK,CAAA;AAAA,EACzE;AACD;AAEO,SAAS,0BAAA,CACf,SACA,cAAA,EACuB;AACvB,EAAA,MAAM,MAAA,GAAS,QAAQ,gBAAA,IAAoB,uBAAA;AAE3C,EAAA,MAAM,UAAA,GAAa,QAAQ,UAAA,IAAc,iBAAA;AAGzC,EAAA,IAAI,CAAC,WAAW,eAAA,EAAiB;AAChC,IAAA,MAAM,IAAI,KAAA;AAAA,MACT;AAAA,KAED;AAAA,EACD;AAEA,EAAA,IAAI,CAAC,WAAW,WAAA,EAAa;AAC5B,IAAA,MAAM,IAAI,KAAA;AAAA,MACT;AAAA,KAED;AAAA,EACD;AAEA,EAAA,IAAI,CAAC,WAAW,UAAA,EAAY;AAC3B,IAAA,MAAM,IAAI,KAAA;AAAA,MACT;AAAA,KAED;AAAA,EACD;AAEA,EAAA,MAAM,SAAS,OAAA,CAAQ,MAAA;AACvB,EAAA,MAAM,aAAA,GAAgB,QAAQ,aAAA,IAAiB,CAAA;AAC/C,EAAA,MAAM,GAAA,GAAM,QAAQ,GAAA,IAAO,EAAA;AAC3B,EAAA,MAAM,UAAA,GAAa,IAAA,CAAK,KAAA,CAAM,aAAA,GAAgB,GAAG,CAAA;AAGjD,EAAA,MAAM,OAAA,GAAU,sBAAsB,cAAc,CAAA;AACpD,EAAA,MAAM,WAAA,GAAc,kBAAkB,MAAM,CAAA;AAC5C,EAAA,MAAM,GAAA,GAAM,4BAA4B,MAAM,CAAA;AAC9C,EAAA,MAAM,eAAe,kBAAA,EAAmB;AAExC,EAAA,MAAM,aAAa,wBAAA,EAAyB;AAC5C,EAAA,MAAM,aAAA,GAAgB,yBAAyB,UAAU,CAAA;AAGzD,EAAA,IAAI,SAAwB,EAAC;AAC7B,EAAA,IAAI,gBAAA,GAAmB,KAAK,GAAA,EAAI;AAChC,EAAA,IAAI,mBAAA,GAAsB,CAAA;AAC1B,EAAA,MAAM,qBAAA,GAAwB,CAAA;AAC9B,EAAA,IAAI,UAAA,GAAa,CAAA;AAGjB,EAAA,IAAI,eAAA,GAA2C,IAAA;AAG/C,EAAA,IAAI,gBAAA;AACJ,EAAA,IAAI,kBAAA;AAEJ,EAAA,SAAS,SAAS,QAAA,EAA+C;AAChE,IAAA,gBAAA,GAAmB,QAAA;AAAA,EACpB;AAEA,EAAA,SAAS,WAAW,QAAA,EAAsD;AACzE,IAAA,kBAAA,GAAqB,QAAA;AAAA,EACtB;AAMA,EAAA,eAAe,aACd,KAAA,EAC8B;AAM9B,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAC3B,IAAA,MAAM,eAAA,GAAkB,OAAA,CAAQ,YAAA,CAAa,KAAA,EAAO,SAAS,CAAA;AAE7D,IAAA,IACC,CAAC,mBACD,CAAC,eAAA,CAAgB,iBACjB,eAAA,CAAgB,aAAA,CAAc,WAAW,CAAA,EACxC;AAED,MAAA,OAAO,IAAA;AAAA,IACR;AAEA,IAAA,MAAM,cAAA,GAAiB,eAAA,CAAgB,aAAA,CAAc,CAAC,CAAA;AACtD,IAAA,IAAI,CAAC,cAAA,EAAgB;AACpB,MAAA,OAAO,IAAA;AAAA,IACR;AACA,IAAA,MAAM,SAAA,GAAY,cAAA;AAClB,IAAA,MAAM,WAAA,GAAc,eAAA,CAAgB,eAAA,GAAkB,CAAC,KAAK,EAAC;AAE7D,IAAA,IAAI,KAAA,GAAQ,IAAA;AACZ,IAAA,IAAI,MAAA,GAAS,GAAA;AAEb,IAAA,IAAI,iBAAiB,gBAAA,EAAkB;AACtC,MAAA,KAAA,GAAQ,KAAA,CAAM,UAAA;AACd,MAAA,MAAA,GAAS,KAAA,CAAM,WAAA;AAAA,IAChB,CAAA,MAAA,IAAW,iBAAiB,iBAAA,EAAmB;AAC9C,MAAA,KAAA,GAAQ,KAAA,CAAM,KAAA;AACd,MAAA,MAAA,GAAS,KAAA,CAAM,MAAA;AAAA,IAChB,CAAA,MAAA,IAAW,iBAAiB,SAAA,EAAW;AACtC,MAAA,KAAA,GAAQ,KAAA,CAAM,KAAA;AACd,MAAA,MAAA,GAAS,KAAA,CAAM,MAAA;AAAA,IAChB;AAEA,IAAA,MAAM,EAAE,GAAA,EAAK,UAAA,EAAW,GAAI,YAAA,CAAa,OAAA;AAAA,MACxC,WAAA;AAAA,MACA,SAAA;AAAA,MACA,KAAA;AAAA,MACA;AAAA,KACD;AAEA,IAAA,MAAM,UAAA,GAAa,WAAA,CAAY,OAAA,CAAQ,SAAS,CAAA;AAChD,IAAA,MAAM,UAAA,GAAa,GAAA,CAAI,UAAA,CAAW,SAAS,CAAA;AAI3C,IAAA,UAAA,EAAA;AACA,IAAA,MAAM,gBACL,UAAA,GAAa,GAAA,KACZ,UAAA,GAAa,qBAAA,KAA0B,KAAK,mBAAA,KAAwB,CAAA,CAAA;AAEtE,IAAA,IAAI,aAAA,EAAe;AAClB,MAAA,IAAI;AACH,QAAA,MAAM,SAAA,GAAY,YAAY,GAAA,EAAI;AAElC,QAAA,MAAM,UAAU,MAAM,UAAA,CAAW,OAAA,CAAQ,SAAA,EAAW,OAAO,MAAM,CAAA;AACjE,QAAA,MAAM,QAAA,GAAW,WAAA,CAAY,GAAA,EAAI,GAAI,SAAA;AACrC,QAAA,mBAAA,GAAsB,QAAA;AAEtB,QAAA,IAAI,WAAW,EAAA,EAAI;AAClB,UAAA,OAAA,CAAQ,IAAA;AAAA,YACP,CAAA,8BAAA,EAAiC,QAAA,CAAS,OAAA,CAAQ,CAAC,CAAC,CAAA,EAAA;AAAA,WACrD;AAAA,QACD;AAEA,QAAA,IAAI,OAAA,CAAQ,OAAO,CAAA,CAAA,EAAM;AACxB,UAAA,GAAA,CAAI,MAAM,IAAA,CAAK,GAAA,CAAI,GAAA,CAAI,GAAA,IAAO,GAAG,IAAI,CAAA;AAAA,QACtC;AACA,QAAA,IAAI,OAAA,CAAQ,OAAO,CAAA,GAAA,EAAM;AACxB,UAAA,GAAA,CAAI,MAAM,IAAA,CAAK,GAAA,CAAI,GAAA,CAAI,GAAA,IAAO,GAAG,GAAG,CAAA;AAAA,QACrC;AACA,QAAA,IAAI,IAAA,CAAK,GAAA,CAAI,OAAA,CAAQ,KAAK,IAAI,CAAA,EAAK;AAClC,UAAA,MAAM,QAAA,GAAW,CAAC,MAAA,EAAQ,MAAA,EAAQ,MAAM,CAAA;AACxC,UAAA,KAAA,MAAW,OAAO,QAAA,EAAU;AAC3B,YAAA,IAAA,CAAK,GAAA,CAAI,GAAG,CAAA,IAAK,CAAA,IAAK,GAAA,EAAK;AAC1B,cAAA,GAAA,CAAI,GAAG,CAAA,GAAA,CAAK,GAAA,CAAI,GAAG,KAAK,CAAA,IAAK,IAAA;AAAA,YAC9B;AAAA,UACD;AAAA,QACD;AAAA,MACD,CAAA,CAAA,MAAQ;AAAA,MAGR;AAAA,IACD;AAEA,IAAA,MAAM,IAAA,GAAO,UAAU,CAAC,CAAA;AACxB,IAAA,MAAM,IAAA,GAAO,UAAU,GAAG,CAAA;AAC1B,IAAA,MAAM,IAAA,GAAO,UAAU,GAAG,CAAA;AAE1B,IAAA,IAAI,IAAA,IAAQ,QAAQ,IAAA,EAAM;AACzB,MAAA,MAAM,SAAA,GAAY,IAAA,CAAK,CAAA,GAAI,IAAA,CAAK,CAAA;AAChC,MAAA,MAAM,UAAU,SAAA,KAAc,CAAA,GAAA,CAAK,KAAK,CAAA,GAAI,IAAA,CAAK,KAAK,SAAA,GAAY,GAAA;AAElE,MAAA,MAAM,IAAA,GAAoB;AAAA,QACzB,MAAM,UAAA,CAAW,MAAA;AAAA,QACjB,WAAA,EAAa,UAAA;AAAA,QACb,QAAA,EAAA,CAAW,UAAU,GAAA,IAAO,GAAA;AAAA,QAC5B,aAAa,IAAA,CAAK,CAAA,GAAA,CAAK,KAAK,CAAA,GAAI,IAAA,CAAK,KAAK,CAAA,IAAK;AAAA,OAChD;AAEA,MAAA,MAAA,CAAO,IAAA,CAAK;AAAA,QACX,GAAA,EAAK,EAAE,GAAG,GAAA,EAAI;AAAA,QACd,IAAA;AAAA,QACA;AAAA,OACA,CAAA;AAED,MAAA,IAAI,MAAA,CAAO,SAAS,UAAA,EAAY;AAC/B,QAAA,MAAA,CAAO,KAAA,EAAM;AAAA,MACd;AAGA,MAAA,MAAM,qBAAA,GAAA,CAAyB,YAAY,gBAAA,IAAoB,GAAA;AAC/D,MAAA,IAAI,yBAAyB,aAAA,EAAe;AAE3C,QAAA,IAAI,MAAA,CAAO,MAAA,IAAU,UAAA,GAAa,GAAA,EAAK;AACtC,UAAA,MAAM,UAAA,GAAa,OAAO,CAAC,CAAA;AAC3B,UAAA,IAAI,CAAC,UAAA,EAAY;AAChB,YAAA,OAAO,IAAA;AAAA,UACR;AAGA,UAAA,MAAM,OAAA,GAAU,MAAA,CAAO,IAAA,CAAK,UAAA,CAAW,GAAG,CAAA;AAC1C,UAAA,MAAM,aAA0B,EAAC;AAEjC,UAAA,KAAA,MAAW,OAAO,OAAA,EAAS;AAC1B,YAAA,MAAM,SAAS,MAAA,CACb,GAAA,CAAI,CAAC,KAAA,KAAU,MAAM,GAAA,CAAI,GAAG,CAAA,IAAK,CAAC,EAClC,IAAA,CAAK,CAAC,CAAA,EAAG,CAAA,KAAM,IAAI,CAAC,CAAA;AACtB,YAAA,MAAM,iBAAA,GAAoB,IAAA,CAAK,KAAA,CAAM,MAAA,CAAO,SAAS,IAAI,CAAA;AACzD,YAAA,UAAA,CAAW,GAAG,CAAA,GAAI,MAAA,CAAO,iBAAiB,CAAA,IAAK,CAAA;AAAA,UAChD;AAGA,UAAA,MAAM,SAAA,GAAY,MAAA,CAAO,MAAA,CAAO,MAAA,GAAS,CAAC,CAAA;AAC1C,UAAA,IAAI,CAAC,SAAA,EAAW;AACf,YAAA,OAAO,IAAA;AAAA,UACR;AAGA,UAAA,MAAM,aAAA,GAA+B;AAAA,YACpC,GAAA,EAAK,UAAA;AAAA,YACL,MAAM,SAAA,CAAU;AAAA,WACjB;AAGA,UAAA,eAAA,GAAkB,aAAA,CAAc,QAAQ,aAAa,CAAA;AACrD,UAAA,gBAAA,GAAmB,SAAA;AAGnB,UAAA,IAAI,sBAAsB,eAAA,EAAiB;AAC1C,YAAA,IAAI;AACH,cAAA,kBAAA,CAAmB,eAAe,CAAA;AAAA,YACnC,SAAS,KAAA,EAAO;AACf,cAAA,OAAA,CAAQ,KAAA,CAAM,yCAAyC,KAAK,CAAA;AAAA,YAC7D;AAAA,UACD;AAGA,UAAA,IAAI,UAAU,eAAA,EAAiB;AAE9B,YAAA,SAAA,CAAU,MAAA,EAAQ,eAAe,CAAA,CAAE,KAAA,CAAM,MAAM;AAAA,YAE/C,CAAC,CAAA;AAAA,UACF;AAAA,QACD;AAAA,MACD;AAEA,MAAA,MAAM,MAAA,GAAsB;AAAA,QAC3B,GAAA;AAAA,QACA,IAAA;AAAA,QACA,UAAA;AAAA,QACA,QAAA,EAAU,MAAA,CAAO,MAAA,IAAU,UAAA,GAAa,GAAA;AAAA,QACxC,iBAAiB,eAAA,IAAmB;AAAA,OACrC;AAEA,MAAA,IAAI,gBAAA,EAAkB;AACrB,QAAA,IAAI;AACH,UAAA,gBAAA,CAAiB,MAAM,CAAA;AAAA,QACxB,SAAS,KAAA,EAAO;AACf,UAAA,OAAA,CAAQ,KAAA,CAAM,uCAAuC,KAAK,CAAA;AAAA,QAC3D;AAAA,MACD;AAEA,MAAA,OAAO,MAAA;AAAA,IACR;AAEA,IAAA,OAAO,IAAA;AAAA,EACR;AAEA,EAAA,SAAS,UAAU,UAAA,EAA+B;AACjD,IAAA,YAAA,CAAa,UAAU,UAAU,CAAA;AAAA,EAClC;AAEA,EAAA,SAAS,gBAAA,GAAyB;AACjC,IAAA,YAAA,CAAa,gBAAA,EAAiB;AAAA,EAC/B;AAEA,EAAA,SAAS,kBAAA,GAA8C;AACtD,IAAA,OAAO,eAAA;AAAA,EACR;AAEA,EAAA,SAAS,WAAA,GAAoB;AAC5B,IAAA,MAAA,GAAS,EAAC;AACV,IAAA,gBAAA,GAAmB,KAAK,GAAA,EAAI;AAAA,EAC7B;AAEA,EAAA,OAAO;AAAA,IACN,YAAA;AAAA,IACA,SAAA;AAAA,IACA,gBAAA;AAAA,IACA,kBAAA;AAAA,IACA,WAAA;AAAA,IACA,QAAA;AAAA,IACA;AAAA,GACD;AACD","file":"index.js","sourcesContent":["{\n  \"version\": \"1.0.0\",\n  \"description\": \"Mapping from MediaPipe blendshapes to FACS Action Units (AUs)\",\n  \"mappings\": {\n    \"AU1\": {\n      \"type\": \"direct\",\n      \"blendshapes\": [\"browInnerUp\"]\n    },\n    \"AU2\": {\n      \"type\": \"average\",\n      \"blendshapes\": [\"browOuterUpLeft\", \"browOuterUpRight\"]\n    },\n    \"AU4\": {\n      \"type\": \"composite\",\n      \"base\": {\n        \"type\": \"average\",\n        \"blendshapes\": [\"browDownLeft\", \"browDownRight\"]\n      },\n      \"additions\": [\n        {\n          \"source\": \"AU1\",\n          \"multiplier\": 0.1\n        }\n      ]\n    },\n    \"AU5\": {\n      \"type\": \"average\",\n      \"blendshapes\": [\"eyeWideLeft\", \"eyeWideRight\"]\n    },\n    \"AU6\": {\n      \"type\": \"average\",\n      \"blendshapes\": [\"cheekSquintLeft\", \"cheekSquintRight\"]\n    },\n    \"AU7\": {\n      \"type\": \"average\",\n      \"blendshapes\": [\"eyeSquintLeft\", \"eyeSquintRight\"]\n    },\n    \"AU43\": {\n      \"type\": \"average\",\n      \"blendshapes\": [\"eyeBlinkLeft\", \"eyeBlinkRight\"]\n    },\n    \"AU45\": {\n      \"type\": \"reference\",\n      \"source\": \"AU43\"\n    },\n    \"AU9\": {\n      \"type\": \"average\",\n      \"blendshapes\": [\"noseSneerLeft\", \"noseSneerRight\"]\n    },\n    \"AU10\": {\n      \"type\": \"average\",\n      \"blendshapes\": [\"mouthUpperUpLeft\", \"mouthUpperUpRight\"]\n    },\n    \"AU12\": {\n      \"type\": \"composite\",\n      \"base\": {\n        \"type\": \"average\",\n        \"blendshapes\": [\"mouthSmileLeft\", \"mouthSmileRight\"]\n      },\n      \"additions\": [\n        {\n          \"source\": {\n            \"type\": \"average\",\n            \"blendshapes\": [\"mouthDimpleLeft\", \"mouthDimpleRight\"]\n          },\n          \"multiplier\": 1.3\n        }\n      ]\n    },\n    \"AU14\": {\n      \"type\": \"average\",\n      \"blendshapes\": [\"mouthDimpleLeft\", \"mouthDimpleRight\"]\n    },\n    \"AU15\": {\n      \"type\": \"average\",\n      \"blendshapes\": [\"mouthFrownLeft\", \"mouthFrownRight\"]\n    },\n    \"AU17\": {\n      \"type\": \"direct\",\n      \"blendshapes\": [\"chinRaise\"]\n    },\n    \"AU18\": {\n      \"type\": \"direct\",\n      \"blendshapes\": [\"mouthPucker\"]\n    },\n    \"AU20\": {\n      \"type\": \"average\",\n      \"blendshapes\": [\"mouthStretchLeft\", \"mouthStretchRight\"]\n    },\n    \"AU23\": {\n      \"type\": \"composite\",\n      \"base\": {\n        \"type\": \"average\",\n        \"blendshapes\": [\"mouthPressLeft\", \"mouthPressRight\"]\n      },\n      \"multiplier\": 0.9\n    },\n    \"AU24\": {\n      \"type\": \"average\",\n      \"blendshapes\": [\"mouthPressLeft\", \"mouthPressRight\"]\n    },\n    \"AU25\": {\n      \"type\": \"direct\",\n      \"blendshapes\": [\"jawOpen\"]\n    },\n    \"AU26\": {\n      \"type\": \"direct\",\n      \"blendshapes\": [\"jawDrop\"]\n    },\n    \"AU28\": {\n      \"type\": \"average\",\n      \"blendshapes\": [\"mouthRollUpper\", \"mouthRollLower\"]\n    }\n  }\n}\n","/**\n * AU Mapper: Processa a configurao JSON para calcular Action Units a partir de blendshapes\n */\n\nimport auMappingsConfig from \"@json/au_mappings.json\";\n\ntype BlendshapeMap = Record<string, number>;\ntype ActionUnits = Record<string, number>;\n\ninterface DirectMapping {\n\ttype: \"direct\";\n\tblendshapes: string[];\n}\n\ninterface AverageMapping {\n\ttype: \"average\";\n\tblendshapes: string[];\n}\n\ninterface ReferenceMapping {\n\ttype: \"reference\";\n\tsource: string;\n}\n\ninterface CompositeMapping {\n\ttype: \"composite\";\n\tbase: DirectMapping | AverageMapping | CompositeMapping;\n\tmultiplier?: number;\n\tadditions?: Array<{\n\t\tsource: string | DirectMapping | AverageMapping;\n\t\tmultiplier: number;\n\t}>;\n}\n\ntype AUMapping =\n\t| DirectMapping\n\t| AverageMapping\n\t| ReferenceMapping\n\t| CompositeMapping;\n\ninterface AUMappingsConfig {\n\tmappings: Record<string, AUMapping>;\n}\n\nfunction calculateMappingValue(\n\tmapping: AUMapping,\n\tbs: BlendshapeMap,\n\tcalculatedAus: ActionUnits,\n): number {\n\tswitch (mapping.type) {\n\t\tcase \"direct\": {\n\t\t\tconst value = mapping.blendshapes\n\t\t\t\t.map((name) => bs[name] || 0)\n\t\t\t\t.reduce((sum, val) => sum + val, 0);\n\t\t\treturn value;\n\t\t}\n\n\t\tcase \"average\": {\n\t\t\tconst values = mapping.blendshapes.map((name) => bs[name] || 0);\n\t\t\tif (values.length === 0) return 0;\n\t\t\tconst sum = values.reduce((acc, val) => acc + val, 0);\n\t\t\treturn sum / values.length;\n\t\t}\n\n\t\tcase \"reference\": {\n\t\t\treturn calculatedAus[mapping.source] || 0;\n\t\t}\n\n\t\tcase \"composite\": {\n\t\t\tlet value = calculateMappingValue(mapping.base, bs, calculatedAus);\n\n\t\t\tif (mapping.multiplier !== undefined) {\n\t\t\t\tvalue *= mapping.multiplier;\n\t\t\t}\n\n\t\t\tif (mapping.additions) {\n\t\t\t\tfor (const addition of mapping.additions) {\n\t\t\t\t\tlet additionValue: number;\n\t\t\t\t\tif (typeof addition.source === \"string\") {\n\t\t\t\t\t\tadditionValue = calculatedAus[addition.source] || 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tadditionValue = calculateMappingValue(\n\t\t\t\t\t\t\taddition.source,\n\t\t\t\t\t\t\tbs,\n\t\t\t\t\t\t\tcalculatedAus,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tvalue += additionValue * addition.multiplier;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\n\t\tdefault:\n\t\t\treturn 0;\n\t}\n}\n\nexport function calculateAUsFromMappings(bs: BlendshapeMap): ActionUnits {\n\tconst config = auMappingsConfig as AUMappingsConfig;\n\tconst aus: ActionUnits = {};\n\n\tconst auOrder = Object.keys(config.mappings);\n\tfor (const auName of auOrder) {\n\t\tconst mapping = config.mappings[auName];\n\t\taus[auName] = calculateMappingValue(mapping as AUMapping, bs, aus);\n\t}\n\n\treturn aus;\n}\n","/**\n * Geometria utilidades para clculos 3D com landmarks faciais\n * Foca em distncias relativas e vetores para ignorar escala\n */\n\nimport type { LandmarkPoint } from \"@type/index\";\n\nexport function euclideanDistance(\n\tp1: LandmarkPoint,\n\tp2: LandmarkPoint,\n): number {\n\treturn Math.sqrt(\n\t\t(p1.x - p2.x) ** 2 + (p1.y - p2.y) ** 2 + (p1.z - p2.z) ** 2,\n\t);\n}\n\nexport function euclideanDistance2D(\n\tp1: LandmarkPoint,\n\tp2: LandmarkPoint,\n\tw: number,\n\th: number,\n): number {\n\tconst x1 = p1.x * w;\n\tconst y1 = p1.y * h;\n\tconst x2 = p2.x * w;\n\tconst y2 = p2.y * h;\n\treturn Math.sqrt((x1 - x2) ** 2 + (y1 - y2) ** 2);\n}\n\nexport function getVector(\n\tpStart: LandmarkPoint,\n\tpEnd: LandmarkPoint,\n): [number, number, number] {\n\treturn [pEnd.x - pStart.x, pEnd.y - pStart.y, pEnd.z - pStart.z];\n}\n\nexport function calculateRelativeVelocity(\n\tposCurr: [number, number, number],\n\tposPrev: [number, number, number],\n\tanchorCurr: [number, number, number],\n\tanchorPrev: [number, number, number],\n\tdt: number,\n): number {\n\tif (dt <= 0) return 0.0;\n\n\tconst vPoint: [number, number, number] = [\n\t\t(posCurr[0] - posPrev[0]) / dt,\n\t\t(posCurr[1] - posPrev[1]) / dt,\n\t\t(posCurr[2] - posPrev[2]) / dt,\n\t];\n\n\tconst vHead: [number, number, number] = [\n\t\t(anchorCurr[0] - anchorPrev[0]) / dt,\n\t\t(anchorCurr[1] - anchorPrev[1]) / dt,\n\t\t(anchorCurr[2] - anchorPrev[2]) / dt,\n\t];\n\n\tconst vClean: [number, number, number] = [\n\t\tvPoint[0] - vHead[0],\n\t\tvPoint[1] - vHead[1],\n\t\tvPoint[2] - vHead[2],\n\t];\n\n\tconst vCleanMagnitude = Math.sqrt(\n\t\tvClean[0] ** 2 + vClean[1] ** 2 + vClean[2] ** 2,\n\t);\n\n\treturn vCleanMagnitude;\n}\n\nexport function vectorNorm(vector: [number, number, number]): number {\n\treturn Math.sqrt(vector[0] ** 2 + vector[1] ** 2 + vector[2] ** 2);\n}\n\nexport function calculateDivergence(\n\tlandmarks: LandmarkPoint[],\n\tindices: number[],\n\tw: number,\n\th: number,\n): number {\n\tconst pts: [number, number][] = indices.map((i) => {\n\t\tconst landmark = landmarks[i];\n\t\tif (!landmark) return [0, 0];\n\t\treturn [landmark.x * w, landmark.y * h];\n\t});\n\n\tif (pts.length === 0) return 0;\n\n\tconst centerX = pts.reduce((sum, pt) => sum + pt[0], 0) / pts.length;\n\tconst centerY = pts.reduce((sum, pt) => sum + pt[1], 0) / pts.length;\n\n\tlet divergence = 0;\n\tfor (const pt of pts) {\n\t\tconst [x, y] = pt;\n\t\tconst dist = Math.sqrt((x - centerX) ** 2 + (y - centerY) ** 2);\n\t\tdivergence += dist;\n\t}\n\n\treturn divergence;\n}\n","{\n  \"version\": \"1.0.0\",\n  \"description\": \"Physical validations using landmarks to validate AU calculations\",\n  \"validations\": {\n    \"AU4\": {\n      \"type\": \"divergence\",\n      \"description\": \"Valida AU4 (testa franzida) usando divergncia geomtrica das sobrancelhas\",\n      \"landmarkIndices\": [107, 336, 9, 66, 296],\n      \"conditions\": {\n        \"auThreshold\": 0.15,\n        \"divergenceDeltaThreshold\": 6.0\n      },\n      \"action\": {\n        \"type\": \"penalize\",\n        \"multiplier\": 0.2\n      }\n    }\n  }\n}\n","/**\n * Physical Validator: Aplica validaes fsicas usando landmarks para validar clculos de AUs\n */\n\nimport { calculateDivergence } from \"@core/geometry_utils\";\nimport physicalValidationsConfig from \"@json/physical_validations.json\";\nimport type { ActionUnits, LandmarkPoint } from \"@type/index\";\n\ninterface DivergenceValidation {\n\ttype: \"divergence\";\n\tdescription?: string;\n\tlandmarkIndices: number[];\n\tconditions: {\n\t\tauThreshold: number;\n\t\tdivergenceDeltaThreshold: number;\n\t};\n\taction: {\n\t\ttype: \"penalize\";\n\t\tmultiplier: number;\n\t};\n}\n\ntype PhysicalValidation = DivergenceValidation;\n\ninterface PhysicalValidationsConfig {\n\tvalidations: Record<string, PhysicalValidation>;\n}\n\ninterface ValidationState {\n\tbaselineDiv: number | null;\n\tcalibrated: boolean;\n}\n\nexport function createPhysicalValidator() {\n\tconst config = physicalValidationsConfig as PhysicalValidationsConfig;\n\tconst states = new Map<string, ValidationState>();\n\n\tfunction applyValidations(\n\t\taus: ActionUnits,\n\t\tlandmarks: LandmarkPoint[],\n\t\tw: number,\n\t\th: number,\n\t): ActionUnits {\n\t\tconst result = { ...aus };\n\n\t\tfor (const [auName, validation] of Object.entries(config.validations)) {\n\t\t\tif (validation.type === \"divergence\") {\n\t\t\t\tconst state = states.get(auName) || {\n\t\t\t\t\tbaselineDiv: null,\n\t\t\t\t\tcalibrated: false,\n\t\t\t\t};\n\n\t\t\t\tconst currDiv = calculateDivergence(\n\t\t\t\t\tlandmarks,\n\t\t\t\t\tvalidation.landmarkIndices,\n\t\t\t\t\tw,\n\t\t\t\t\th,\n\t\t\t\t);\n\n\t\t\t\tif (!state.calibrated) {\n\t\t\t\t\tstate.baselineDiv = currDiv;\n\t\t\t\t\tstate.calibrated = true;\n\t\t\t\t\tstates.set(auName, state);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst divDelta = currDiv - (state.baselineDiv || 0);\n\t\t\t\tconst auValue = result[auName] || 0;\n\n\t\t\t\tif (\n\t\t\t\t\tauValue > validation.conditions.auThreshold &&\n\t\t\t\t\tdivDelta > validation.conditions.divergenceDeltaThreshold\n\t\t\t\t) {\n\t\t\t\t\tif (validation.action.type === \"penalize\") {\n\t\t\t\t\t\tresult[auName] = auValue * validation.action.multiplier;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tstates.set(auName, state);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tfunction resetCalibration(): void {\n\t\tstates.clear();\n\t}\n\n\treturn {\n\t\tapplyValidations,\n\t\tresetCalibration,\n\t};\n}\n","/**\n * Hybrid Engine: SMOOTH & CLEAN\n * Adiciona Filtro Temporal (EMA) para eliminar 'flicker' e lixo de leitura.\n */\n\nimport { calculateAUsFromMappings } from \"@config/au_mapper\";\nimport { createPhysicalValidator } from \"@config/physical_validator\";\nimport type { ActionUnits, Blendshape, LandmarkPoint } from \"@type/index\";\n\nexport interface HybridEngineResult {\n\taus: ActionUnits;\n\trotPenalty: number;\n}\n\nexport interface HybridEngine {\n\tprocess(\n\t\tblendshapes: Blendshape[],\n\t\tlandmarks: LandmarkPoint[],\n\t\tw: number,\n\t\th: number,\n\t): HybridEngineResult;\n\tcalibrate(currentAus: ActionUnits): void;\n\tresetCalibration(): void;\n}\n\nfunction calculateRotationPenalty(landmarks: LandmarkPoint[]): number {\n\tif (landmarks.length < 455) return 1.0;\n\n\tconst nose = landmarks[1];\n\tconst earL = landmarks[234];\n\tconst earR = landmarks[454];\n\n\tif (!nose || !earL || !earR) return 1.0;\n\n\tconst faceWidth = Math.abs(earR.x - earL.x);\n\tif (faceWidth === 0) return 1.0;\n\n\tconst ratio = Math.abs(nose.x - earL.x) / faceWidth;\n\tconst deviation = Math.abs(ratio - 0.5);\n\n\tif (deviation > 0.12) {\n\t\treturn Math.min((deviation - 0.12) * 6.0, 1.0);\n\t}\n\treturn 0.0;\n}\n\nexport function createHybridEngine(): HybridEngine {\n\tconst sensitivity = 2.8;\n\tconst noiseGate = 0.04;\n\n\tconst alpha = 0.6;\n\n\tconst prevAus = new Map<string, number>();\n\n\tconst physicalValidator = createPhysicalValidator();\n\n\tlet manualOffsets: ActionUnits = {};\n\tlet isCalibratedManual = false;\n\n\tfunction calibrate(currentAus: ActionUnits): void {\n\t\tconsole.log(\">>> CALIBRATING... NEUTRAL FACE DEFINED.\");\n\t\tmanualOffsets = { ...currentAus };\n\t\tisCalibratedManual = true;\n\t}\n\n\tfunction resetCalibration(): void {\n\t\tconsole.log(\">>> CALIBRATION RESET.\");\n\t\tmanualOffsets = {};\n\t\tisCalibratedManual = false;\n\t}\n\n\tfunction process(\n\t\tblendshapes: Blendshape[],\n\t\tlandmarks: LandmarkPoint[],\n\t\tw: number,\n\t\th: number,\n\t): HybridEngineResult {\n\t\tconst bs: Record<string, number> = {};\n\t\tfor (const b of blendshapes) {\n\t\t\tbs[b.category_name] = b.score;\n\t\t}\n\n\t\tconst rotPenalty = calculateRotationPenalty(landmarks);\n\t\tconst currentGain = sensitivity * (1.0 - rotPenalty * 0.8);\n\n\t\tlet aus: ActionUnits = calculateAUsFromMappings(bs);\n\n\t\taus = physicalValidator.applyValidations(aus, landmarks, w, h);\n\n\t\tconst finalAus: ActionUnits = {};\n\n\t\tfor (const [k, v] of Object.entries(aus)) {\n\t\t\tlet val = (v || 0) ** 0.75 * currentGain;\n\n\t\t\tconst prev = prevAus.get(k) || 0.0;\n\t\t\tconst smoothedVal = val * alpha + prev * (1.0 - alpha);\n\n\t\t\tprevAus.set(k, smoothedVal);\n\n\t\t\tval = smoothedVal;\n\n\t\t\tif (isCalibratedManual) {\n\t\t\t\tconst offset = manualOffsets[k] || 0.0;\n\t\t\t\tval = Math.max(0.0, val - offset);\n\t\t\t}\n\n\t\t\tif (val < noiseGate) val = 0.0;\n\n\t\t\tfinalAus[k] = Math.min(val, 1.0);\n\t\t}\n\n\t\treturn {\n\t\t\taus: finalAus,\n\t\t\trotPenalty,\n\t\t};\n\t}\n\n\treturn {\n\t\tprocess,\n\t\tcalibrate,\n\t\tresetCalibration,\n\t};\n}\n","/**\n * Landmark-Based Flow Engine (Alternativa Rpida ao Optical Flow)\n * \n * Calcula \"strain\" (tenso) baseado na velocidade e acelerao dos landmarks,\n * sem precisar do OpenCV. Muito mais rpido que optical flow denso.\n */\n\nimport type { LandmarkPoint } from \"../types/index\";\n\nexport interface OpticalFlowResult {\n\tbrow: number;\n\tnose: number;\n\tl_cheek: number;\n\tr_cheek: number;\n\tmouth: number;\n}\n\nexport interface LandmarkFlowEngine {\n\tanalyze(\n\t\tlandmarks: LandmarkPoint[],\n\t\tw: number,\n\t\th: number,\n\t): Promise<OpticalFlowResult>;\n\treset(): void;\n}\n\ninterface PreviousLandmarks {\n\tlandmarks: LandmarkPoint[];\n\tvelocities: number[];\n\ttimestamp: number;\n}\n\n// ROIs (Regions of Interest) - mesmas regies do optical flow original\nconst ROIS: Record<string, number[]> = {\n\t// Brow: Corrugator (AU4) e Frontalis (AU1/2)\n\tbrow: [336, 107, 66, 296],\n\n\t// Nariz Superior: Procerus/Nasalis (AU9 - Nojo)\n\tnose: [198, 420, 279, 49],\n\n\t// Bochecha Esq: Zygomaticus Major (AU6/12)\n\tl_cheek: [117, 119, 100, 47],\n\n\t// Bochecha Dir: Zygomaticus Major (AU6/12)\n\tr_cheek: [346, 348, 329, 277],\n\n\t// Boca Completa: Orbicularis Oris\n\tmouth: [61, 291, 0, 17],\n};\n\nfunction calculateDistance(p1: LandmarkPoint, p2: LandmarkPoint): number {\n\tconst dx = (p1.x - p2.x) ** 2;\n\tconst dy = (p1.y - p2.y) ** 2;\n\tconst dz = (p1.z - p2.z) ** 2;\n\treturn Math.sqrt(dx + dy + dz);\n}\n\nfunction calculateROIVelocity(\n\tcurrentLandmarks: LandmarkPoint[],\n\tprevLandmarks: LandmarkPoint[],\n\troiIndices: number[],\n\tw: number,\n\th: number,\n\tdeltaTime: number,\n): number {\n\tif (deltaTime <= 0) return 0;\n\n\tlet totalVelocity = 0;\n\tlet validPoints = 0;\n\n\tfor (const idx of roiIndices) {\n\t\tconst curr = currentLandmarks[idx];\n\t\tconst prev = prevLandmarks[idx];\n\n\t\tif (!curr || !prev) continue;\n\n\t\t// Calcular distncia normalizada (em pixels)\n\t\tconst distance = calculateDistance(\n\t\t\t{ x: curr.x * w, y: curr.y * h, z: curr.z },\n\t\t\t{ x: prev.x * w, y: prev.y * h, z: prev.z },\n\t\t);\n\n\t\t// Velocidade = distncia / tempo (pixels por segundo)\n\t\tconst velocity = distance / deltaTime;\n\t\ttotalVelocity += velocity;\n\t\tvalidPoints++;\n\t}\n\n\tif (validPoints === 0) return 0;\n\treturn totalVelocity / validPoints;\n}\n\nfunction calculateROIAcceleration(\n\tcurrentVelocity: number,\n\tprevVelocity: number,\n\tdeltaTime: number,\n): number {\n\tif (deltaTime <= 0) return 0;\n\treturn Math.abs(currentVelocity - prevVelocity) / deltaTime;\n}\n\nexport function createLandmarkFlowEngine(): LandmarkFlowEngine {\n\tlet previous: PreviousLandmarks | null = null;\n\tconst prevVelocities: Map<string, number> = new Map();\n\n\tfunction analyze(\n\t\tlandmarks: LandmarkPoint[],\n\t\tw: number,\n\t\th: number,\n\t): Promise<OpticalFlowResult> {\n\t\tconst now = performance.now();\n\t\tconst results: OpticalFlowResult = {\n\t\t\tbrow: 0.0,\n\t\t\tnose: 0.0,\n\t\t\tl_cheek: 0.0,\n\t\t\tr_cheek: 0.0,\n\t\t\tmouth: 0.0,\n\t\t};\n\n\t\t// Se no temos frame anterior, apenas armazenar e retornar zeros\n\t\tif (!previous) {\n\t\t\tprevious = {\n\t\t\t\tlandmarks: landmarks.map((l) => ({ ...l })),\n\t\t\t\tvelocities: [],\n\t\t\t\ttimestamp: now,\n\t\t\t};\n\t\t\treturn Promise.resolve(results);\n\t\t}\n\n\t\tconst deltaTime = (now - previous.timestamp) / 1000; // Converter para segundos\n\t\tif (deltaTime <= 0 || deltaTime > 1.0) {\n\t\t\t// Resetar se deltaTime invlido (muito grande = frame perdido)\n\t\t\tprevious = {\n\t\t\t\tlandmarks: landmarks.map((l) => ({ ...l })),\n\t\t\t\tvelocities: [],\n\t\t\t\ttimestamp: now,\n\t\t\t};\n\t\t\tprevVelocities.clear();\n\t\t\treturn Promise.resolve(results);\n\t\t}\n\n\t\t// Calcular strain para cada ROI\n\t\tfor (const [roiName, roiIndices] of Object.entries(ROIS)) {\n\t\t\t// 1. Calcular velocidade atual dos landmarks nesta ROI\n\t\t\tconst currentVelocity = calculateROIVelocity(\n\t\t\t\tlandmarks,\n\t\t\t\tprevious.landmarks,\n\t\t\t\troiIndices,\n\t\t\t\tw,\n\t\t\t\th,\n\t\t\t\tdeltaTime,\n\t\t\t);\n\n\t\t\t// 2. Calcular acelerao (mudana de velocidade)\n\t\t\tconst prevVelocity = prevVelocities.get(roiName) || 0;\n\t\t\tconst acceleration = calculateROIAcceleration(\n\t\t\t\tcurrentVelocity,\n\t\t\t\tprevVelocity,\n\t\t\t\tdeltaTime,\n\t\t\t);\n\n\t\t\t// 3. Strain = combinao de velocidade alta + acelerao alta\n\t\t\t// Frmula similar ao optical flow: strain negativo = contrao, positivo = expanso\n\t\t\t// Multiplicamos por fatores para aproximar os valores do optical flow original\n\t\t\tconst velocityStrain = currentVelocity * 50; // Fator de escala\n\t\t\tconst accelerationStrain = acceleration * 200; // Fator de escala para acelerao\n\n\t\t\t// Strain total: negativo quando h contrao rpida (tenso)\n\t\t\t// Usamos acelerao negativa (desacelerao) como indicador de tenso\n\t\t\tconst strain = velocityStrain - accelerationStrain;\n\n\t\t\tresults[roiName as keyof OpticalFlowResult] = strain;\n\t\t\tprevVelocities.set(roiName, currentVelocity);\n\t\t}\n\n\t\t// Atualizar estado anterior\n\t\tprevious = {\n\t\t\tlandmarks: landmarks.map((l) => ({ ...l })),\n\t\t\tvelocities: [],\n\t\t\ttimestamp: now,\n\t\t};\n\n\t\treturn Promise.resolve(results);\n\t}\n\n\tfunction reset(): void {\n\t\tprevious = null;\n\t\tprevVelocities.clear();\n\t}\n\n\treturn {\n\t\tanalyze,\n\t\treset,\n\t};\n}\n","/**\n * Configurao de Limiares para Anlise de Expresso Facial\n */\n\nimport type { ThresholdsConfig } from \"@type/index\";\n\nexport const defaultThresholdsConfig: ThresholdsConfig = {\n\tsystem: {\n\t\tcamera_index: 0,\n\t\tresolution: [1280, 720],\n\t\tfps_target: 30,\n\t},\n\tbaseline: {\n\t\twindow_size: 90,\n\t\twarmup_frames: 45,\n\t},\n\tsafety: {\n\t\tmax_head_rotation_yaw: 30.0,\n\t\tmax_head_rotation_pitch: 25.0,\n\t\tmin_iod_pixels: 40,\n\t\tmax_gaze_deviation: 30.0,\n\t},\n\tdynamics: {\n\t\ttemporal_buffer_size: 5,\n\t\tacceleration_threshold: 600.0,\n\t\tmin_persistence_frames: 1,\n\t},\n\ttexture: {\n\t\troi_size: 64,\n\t\tvariance_threshold: 5.0,\n\t},\n\tgeometry: {\n\t\tbrow_sensitivity: 4.0,\n\t\tmouth_sensitivity: 3.0,\n\t},\n\tvad: {\n\t\tspeaking_threshold: 0.2,\n\t},\n};\n","{\n  \"version\": \"FACS_IA_decision_ready_v1\",\n  \"generated_at\": \"2025-12-22T02:30:31Z\",\n  \"dimensions\": {\n    \"engagement\": {\n      \"desc\": \"engajamento/ateno (tendncia a participar)\",\n      \"range\": \"-100..+100\"\n    },\n    \"affiliation\": {\n      \"desc\": \"afeto/aproximao (tendncia a vnculo/acolhimento)\",\n      \"range\": \"-100..+100\"\n    },\n    \"approval\": {\n      \"desc\": \"aprovao/alinhamento com proposta\",\n      \"range\": \"-100..+100\"\n    },\n    \"resistance\": {\n      \"desc\": \"resistncia/bloqueio (tendncia a discordar/fechar)\",\n      \"range\": \"-100..+100\"\n    },\n    \"stress_load\": {\n      \"desc\": \"carga/estresse (sobrecarga cognitiva/presso)\",\n      \"range\": \"-100..+100\"\n    },\n    \"aversion\": {\n      \"desc\": \"averso/nojo/desprezo (rejeio do estmulo)\",\n      \"range\": \"-100..+100\"\n    },\n    \"incongruence_risk\": {\n      \"desc\": \"risco de incongruncia (fala vs sinais) / reteno\",\n      \"range\": \"-100..+100\"\n    }\n  },\n  \"scales\": {\n    \"intensity_scale\": [\n      \"A\",\n      \"B\",\n      \"C\",\n      \"D\",\n      \"E\"\n    ],\n    \"laterality_scale\": [\n      \"L\",\n      \"R\",\n      \"B\",\n      \"ASYM\",\n      \"UNK\"\n    ],\n    \"microexpression_threshold_ms\": 500\n  },\n  \"rules\": {\n    \"three_confirmations_rule\": {\n      \"description\": \"Trate hiptese como 'alta confiana' apenas se houver confirmao em 3\\ncamadas (face/voz/corpo/contedo/olhar).\",\n      \"layers\": [\n        \"face\",\n        \"voice\",\n        \"body\",\n        \"content\",\n        \"gaze\"\n      ],\n      \"min_layers\": 3\n    },\n    \"baseline_required\": {\n      \"description\": \"Sempre comparar contra baseline individual (1020s neutros) para evitar\\nfalsos positivos.\"\n    }\n  },\n  \"weights_by_code\": {\n    \"AU1\": {\n      \"engagement\": -5,\n      \"affiliation\": 5,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 10,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"AU2\": {\n      \"engagement\": 10,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 5,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"AU4\": {\n      \"engagement\": -5,\n      \"affiliation\": -5,\n      \"approval\": -10,\n      \"resistance\": 25,\n      \"stress_load\": 15,\n      \"aversion\": 5,\n      \"incongruence_risk\": 10\n    },\n    \"AU5\": {\n      \"engagement\": 15,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 10,\n      \"aversion\": 0,\n      \"incongruence_risk\": 5\n    },\n    \"AU6\": {\n      \"engagement\": 10,\n      \"affiliation\": 25,\n      \"approval\": 15,\n      \"resistance\": -10,\n      \"stress_load\": -5,\n      \"aversion\": -10,\n      \"incongruence_risk\": -5\n    },\n    \"AU7\": {\n      \"engagement\": -5,\n      \"affiliation\": -5,\n      \"approval\": -5,\n      \"resistance\": 10,\n      \"stress_load\": 15,\n      \"aversion\": 0,\n      \"incongruence_risk\": 10\n    },\n    \"AU8\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 0,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"AU9\": {\n      \"engagement\": -10,\n      \"affiliation\": -20,\n      \"approval\": -25,\n      \"resistance\": 25,\n      \"stress_load\": 10,\n      \"aversion\": 40,\n      \"incongruence_risk\": 10\n    },\n    \"AU10\": {\n      \"engagement\": -5,\n      \"affiliation\": -15,\n      \"approval\": -20,\n      \"resistance\": 20,\n      \"stress_load\": 5,\n      \"aversion\": 25,\n      \"incongruence_risk\": 10\n    },\n    \"AU11\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 0,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"AU12\": {\n      \"engagement\": 10,\n      \"affiliation\": 25,\n      \"approval\": 25,\n      \"resistance\": -10,\n      \"stress_load\": -5,\n      \"aversion\": -10,\n      \"incongruence_risk\": -5\n    },\n    \"AU13\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 0,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"AU14\": {\n      \"engagement\": 0,\n      \"affiliation\": -10,\n      \"approval\": -10,\n      \"resistance\": 15,\n      \"stress_load\": 5,\n      \"aversion\": 5,\n      \"incongruence_risk\": 10\n    },\n    \"AU15\": {\n      \"engagement\": -10,\n      \"affiliation\": -10,\n      \"approval\": -20,\n      \"resistance\": 20,\n      \"stress_load\": 10,\n      \"aversion\": 10,\n      \"incongruence_risk\": 5\n    },\n    \"AU16\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 0,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"AU17\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 0,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"AU18\": {\n      \"engagement\": 0,\n      \"affiliation\": -5,\n      \"approval\": -5,\n      \"resistance\": 10,\n      \"stress_load\": 10,\n      \"aversion\": 0,\n      \"incongruence_risk\": 10\n    },\n    \"AU19\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 5,\n      \"stress_load\": 20,\n      \"aversion\": 0,\n      \"incongruence_risk\": 15\n    },\n    \"AU20\": {\n      \"engagement\": -5,\n      \"affiliation\": -10,\n      \"approval\": -10,\n      \"resistance\": 10,\n      \"stress_load\": 25,\n      \"aversion\": 0,\n      \"incongruence_risk\": 15\n    },\n    \"AU21\": {\n      \"engagement\": -5,\n      \"affiliation\": -5,\n      \"approval\": -5,\n      \"resistance\": 20,\n      \"stress_load\": 25,\n      \"aversion\": 0,\n      \"incongruence_risk\": 10\n    },\n    \"AU22\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 0,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"AU23\": {\n      \"engagement\": -5,\n      \"affiliation\": -5,\n      \"approval\": -10,\n      \"resistance\": 25,\n      \"stress_load\": 15,\n      \"aversion\": 5,\n      \"incongruence_risk\": 10\n    },\n    \"AU24\": {\n      \"engagement\": -5,\n      \"affiliation\": -5,\n      \"approval\": -15,\n      \"resistance\": 35,\n      \"stress_load\": 15,\n      \"aversion\": 5,\n      \"incongruence_risk\": 15\n    },\n    \"AU25\": {\n      \"engagement\": 10,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 5,\n      \"aversion\": 0,\n      \"incongruence_risk\": 5\n    },\n    \"AU26\": {\n      \"engagement\": 10,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 10,\n      \"aversion\": 0,\n      \"incongruence_risk\": 5\n    },\n    \"AU27\": {\n      \"engagement\": 10,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 20,\n      \"aversion\": 0,\n      \"incongruence_risk\": 10\n    },\n    \"AU28\": {\n      \"engagement\": -5,\n      \"affiliation\": -5,\n      \"approval\": -5,\n      \"resistance\": 10,\n      \"stress_load\": 25,\n      \"aversion\": 0,\n      \"incongruence_risk\": 10\n    },\n    \"AU41\": {\n      \"engagement\": -25,\n      \"affiliation\": 0,\n      \"approval\": -10,\n      \"resistance\": 10,\n      \"stress_load\": 10,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"AU42\": {\n      \"engagement\": -5,\n      \"affiliation\": -5,\n      \"approval\": -5,\n      \"resistance\": 10,\n      \"stress_load\": 10,\n      \"aversion\": 0,\n      \"incongruence_risk\": 10\n    },\n    \"AU43\": {\n      \"engagement\": -10,\n      \"affiliation\": -5,\n      \"approval\": -10,\n      \"resistance\": 10,\n      \"stress_load\": 15,\n      \"aversion\": 0,\n      \"incongruence_risk\": 10\n    },\n    \"AU44\": {\n      \"engagement\": -5,\n      \"affiliation\": -10,\n      \"approval\": -10,\n      \"resistance\": 15,\n      \"stress_load\": 10,\n      \"aversion\": 5,\n      \"incongruence_risk\": 10\n    },\n    \"AU45\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 5,\n      \"stress_load\": 15,\n      \"aversion\": 0,\n      \"incongruence_risk\": 10\n    },\n    \"AU46\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 0,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"HEAD51\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 0,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"HEAD52\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 0,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"HEAD53\": {\n      \"engagement\": 0,\n      \"affiliation\": -5,\n      \"approval\": -5,\n      \"resistance\": 10,\n      \"stress_load\": 5,\n      \"aversion\": 0,\n      \"incongruence_risk\": 5\n    },\n    \"HEAD54\": {\n      \"engagement\": -5,\n      \"affiliation\": 0,\n      \"approval\": -5,\n      \"resistance\": 5,\n      \"stress_load\": 5,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"HEAD55\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 0,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"HEAD56\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 0,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"HEAD57\": {\n      \"engagement\": 10,\n      \"affiliation\": 0,\n      \"approval\": 5,\n      \"resistance\": -5,\n      \"stress_load\": 5,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"HEAD58\": {\n      \"engagement\": -10,\n      \"affiliation\": -5,\n      \"approval\": -10,\n      \"resistance\": 10,\n      \"stress_load\": 10,\n      \"aversion\": 0,\n      \"incongruence_risk\": 5\n    },\n    \"GAZE61\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 5,\n      \"aversion\": 0,\n      \"incongruence_risk\": 10\n    },\n    \"GAZE62\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 5,\n      \"aversion\": 0,\n      \"incongruence_risk\": 10\n    },\n    \"GAZE63\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 5,\n      \"aversion\": 0,\n      \"incongruence_risk\": 10\n    },\n    \"GAZE64\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 10,\n      \"aversion\": 0,\n      \"incongruence_risk\": 10\n    },\n    \"AD_EXT29\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 0,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"AD_EXT30\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 0,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"AD_EXT31\": {\n      \"engagement\": -5,\n      \"affiliation\": -5,\n      \"approval\": -10,\n      \"resistance\": 25,\n      \"stress_load\": 20,\n      \"aversion\": 0,\n      \"incongruence_risk\": 10\n    },\n    \"AD_EXT32\": {\n      \"engagement\": -5,\n      \"affiliation\": -5,\n      \"approval\": -5,\n      \"resistance\": 10,\n      \"stress_load\": 25,\n      \"aversion\": 0,\n      \"incongruence_risk\": 10\n    },\n    \"AD_EXT34\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 0,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"AD_EXT35\": {\n      \"engagement\": -5,\n      \"affiliation\": -5,\n      \"approval\": -5,\n      \"resistance\": 10,\n      \"stress_load\": 20,\n      \"aversion\": 0,\n      \"incongruence_risk\": 10\n    },\n    \"AD_EXT37\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 0,\n      \"stress_load\": 0,\n      \"aversion\": 0,\n      \"incongruence_risk\": 0\n    },\n    \"AD_EXT38\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 10,\n      \"stress_load\": 15,\n      \"aversion\": 0,\n      \"incongruence_risk\": 10\n    },\n    \"AD_EXT39\": {\n      \"engagement\": 0,\n      \"affiliation\": 0,\n      \"approval\": 0,\n      \"resistance\": 10,\n      \"stress_load\": 15,\n      \"aversion\": 0,\n      \"incongruence_risk\": 10\n    }\n  },\n  \"combo_rules\": [\n    {\n      \"id\": \"C_DUCHENNE\",\n      \"requires\": [\n        \"AU12\",\n        \"AU6\"\n      ],\n      \"forbids\": [],\n      \"description\": \"Sorriso genuno (Duchenne)\",\n      \"adjustments\": {\n        \"engagement\": 10,\n        \"affiliation\": 15,\n        \"approval\": 10,\n        \"resistance\": -10,\n        \"stress_load\": -5,\n        \"aversion\": -10,\n        \"incongruence_risk\": -10\n      },\n      \"tag\": [\n        \"joy_genuine\",\n        \"trust_signal\"\n      ],\n      \"recommended_action\": \"avanar e consolidar acordo\",\n      \"validation_questions\": [\n        \"Faz sentido seguir assim?\",\n        \"Quer que eu formalize os prximos passos?\",\n        \"Tem algo que voc quer ajustar antes de fechar?\"\n      ]\n    },\n    {\n      \"id\": \"C_SOCIAL_SMILE\",\n      \"requires\": [\n        \"AU12\"\n      ],\n      \"forbids\": [\n        \"AU6\"\n      ],\n      \"description\": \"Sorriso social (boca sem olhos)\",\n      \"adjustments\": {\n        \"engagement\": 0,\n        \"affiliation\": -5,\n        \"approval\": -5,\n        \"resistance\": 5,\n        \"stress_load\": 0,\n        \"aversion\": 0,\n        \"incongruence_risk\": 15\n      },\n      \"tag\": [\n        \"polite_mask\"\n      ],\n      \"recommended_action\": \"calibrar antes de avanar\",\n      \"validation_questions\": [\n        \"Em uma escala de 0 a 10, quo ok voc est com isso?\",\n        \"O que voc ainda no est dizendo?\",\n        \"O que precisaria ser verdade pra voc topar?\"\n      ]\n    },\n    {\n      \"id\": \"C_CYNICAL_DEFENSE\",\n      \"requires\": [\n        \"AU14\",\n        \"AU7\"\n      ],\n      \"forbids\": [],\n      \"description\": \"Cinismo defensivo / ironia sob tenso\",\n      \"adjustments\": {\n        \"engagement\": -5,\n        \"affiliation\": -10,\n        \"approval\": -15,\n        \"resistance\": 20,\n        \"stress_load\": 10,\n        \"aversion\": 5,\n        \"incongruence_risk\": 15\n      },\n      \"tag\": [\n        \"defensive_irony\"\n      ],\n      \"recommended_action\": \"reduzir presso e perguntar objeo real\",\n      \"validation_questions\": [\n        \"O que aqui no funciona pra voc?\",\n        \"Qual parte ainda no est confortvel?\",\n        \"Se fosse ajustar 1 coisa, qual seria?\"\n      ]\n    },\n    {\n      \"id\": \"C_ANGER_SUPPRESSED\",\n      \"requires\": [\n        \"AU4\",\n        \"AU23\"\n      ],\n      \"forbids\": [],\n      \"description\": \"Raiva contida (tenso + boca)\",\n      \"adjustments\": {\n        \"engagement\": -5,\n        \"affiliation\": -10,\n        \"approval\": -15,\n        \"resistance\": 30,\n        \"stress_load\": 20,\n        \"aversion\": 5,\n        \"incongruence_risk\": 10\n      },\n      \"tag\": [\n        \"anger_suppressed\"\n      ],\n      \"recommended_action\": \"pausar e descompresso\",\n      \"validation_questions\": [\n        \"O que aqui no funciona pra voc?\",\n        \"Qual parte ainda no est confortvel?\",\n        \"Se fosse ajustar 1 coisa, qual seria?\"\n      ]\n    },\n    {\n      \"id\": \"C_BLOCKED_NO\",\n      \"requires\": [\n        \"AU24\"\n      ],\n      \"forbids\": [],\n      \"description\": \"Bloqueio/discordncia forte (pressor)\",\n      \"adjustments\": {\n        \"engagement\": -5,\n        \"affiliation\": -5,\n        \"approval\": -20,\n        \"resistance\": 35,\n        \"stress_load\": 15,\n        \"aversion\": 0,\n        \"incongruence_risk\": 10\n      },\n      \"tag\": [\n        \"hard_block\"\n      ],\n      \"recommended_action\": \"pausar, espelhar e pedir objeo\",\n      \"validation_questions\": [\n        \"O que aqui no funciona pra voc?\",\n        \"Qual parte ainda no est confortvel?\",\n        \"Se fosse ajustar 1 coisa, qual seria?\"\n      ]\n    },\n    {\n      \"id\": \"C_DISGUST_MORAL\",\n      \"requires\": [\n        \"AU9\",\n        \"AU10\"\n      ],\n      \"forbids\": [],\n      \"description\": \"Nojo + desprezo (averso moral)\",\n      \"adjustments\": {\n        \"engagement\": -15,\n        \"affiliation\": -25,\n        \"approval\": -30,\n        \"resistance\": 25,\n        \"stress_load\": 10,\n        \"aversion\": 40,\n        \"incongruence_risk\": 10\n      },\n      \"tag\": [\n        \"moral_disgust\"\n      ],\n      \"recommended_action\": \"mudar frame e recontratar valor\",\n      \"validation_questions\": [\n        \"O que te incomodou especificamente?\",\n        \"Qual parte soa ruim/errada pra voc?\",\n        \"Que alternativa faria sentido?\"\n      ]\n    },\n    {\n      \"id\": \"C_SADNESS\",\n      \"requires\": [\n        \"AU1\",\n        \"AU15\"\n      ],\n      \"forbids\": [],\n      \"description\": \"Tristeza/desnimo (brow + mouth down)\",\n      \"adjustments\": {\n        \"engagement\": -15,\n        \"affiliation\": 5,\n        \"approval\": -10,\n        \"resistance\": 10,\n        \"stress_load\": 15,\n        \"aversion\": 0,\n        \"incongruence_risk\": 0\n      },\n      \"tag\": [\n        \"sadness\"\n      ],\n      \"recommended_action\": \"acolher e reduzir exigncia\",\n      \"validation_questions\": [\n        \"Quer que a gente faa isso mais simples agora?\",\n        \"O que est pesado hoje?\",\n        \"Como eu posso te ajudar aqui?\"\n      ]\n    },\n    {\n      \"id\": \"C_HIGH_LOAD\",\n      \"requires\": [\n        \"AU45\",\n        \"AU7\"\n      ],\n      \"forbids\": [],\n      \"description\": \"Carga alta (piscar + aperto ocular)\",\n      \"adjustments\": {\n        \"engagement\": -5,\n        \"affiliation\": 0,\n        \"approval\": -5,\n        \"resistance\": 10,\n        \"stress_load\": 30,\n        \"aversion\": 0,\n        \"incongruence_risk\": 15\n      },\n      \"tag\": [\n        \"high_cognitive_load\"\n      ],\n      \"recommended_action\": \"diminuir ritmo e oferecer pausa\",\n      \"validation_questions\": [\n        \"Quer que eu resuma em 1 frase?\",\n        \"Prefere decidir depois com calma?\",\n        \"O que deixaria isso mais leve?\"\n      ]\n    },\n    {\n      \"id\": \"C_AVOIDANCE_RECOIL\",\n      \"requires\": [\n        \"HEAD58\"\n      ],\n      \"forbids\": [],\n      \"description\": \"Recuo/evitao (cabea para trs)\",\n      \"adjustments\": {\n        \"engagement\": -10,\n        \"affiliation\": -5,\n        \"approval\": -10,\n        \"resistance\": 15,\n        \"stress_load\": 10,\n        \"aversion\": 0,\n        \"incongruence_risk\": 5\n      },\n      \"tag\": [\n        \"avoidance\"\n      ],\n      \"recommended_action\": \"dar espao e perguntar preferncia\",\n      \"validation_questions\": [\n        \"Prefere outra opo?\",\n        \"Quer pensar e me dizer depois?\",\n        \"O que deixaria isso confortvel?\"\n      ]\n    }\n  ],\n  \"default_actions_questions\": {\n    \"resistance\": {\n      \"action\": \"pausar, reduzir presso e convidar objeo real\",\n      \"questions\": [\n        \"O que aqui no funciona pra voc?\",\n        \"Qual parte ainda no est confortvel?\",\n        \"Se fosse ajustar 1 coisa, qual seria?\"\n      ]\n    },\n    \"stress_load\": {\n      \"action\": \"diminuir ritmo, oferecer opo simples e tempo\",\n      \"questions\": [\n        \"Quer que eu resuma em 1 frase?\",\n        \"Prefere decidir depois com calma?\",\n        \"O que deixaria isso mais leve?\"\n      ]\n    },\n    \"aversion\": {\n      \"action\": \"mudar enquadramento/tpico e checar valor percebido\",\n      \"questions\": [\n        \"O que te incomodou especificamente?\",\n        \"Qual parte soa ruim/errada pra voc?\",\n        \"Que alternativa faria sentido?\"\n      ]\n    },\n    \"affiliation\": {\n      \"action\": \"aprofundar vnculo e avanar com prxima etapa\",\n      \"questions\": [\n        \"O que mais te agradou nisso?\",\n        \"Quer que eu mostre o prximo passo?\",\n        \"Qual resultado voc quer primeiro?\"\n      ]\n    },\n    \"engagement\": {\n      \"action\": \"aproveitar ateno: perguntar e co-construir\",\n      \"questions\": [\n        \"O que voc quer priorizar?\",\n        \"Onde isso encaixa na sua rotina?\",\n        \"Qual seria o melhor formato pra voc?\"\n      ]\n    },\n    \"incongruence_risk\": {\n      \"action\": \"calibrar com pergunta neutra e checar congruncia\",\n      \"questions\": [\n        \"Em uma escala de 0 a 10, quo ok voc est com isso?\",\n        \"O que voc ainda no est dizendo?\",\n        \"O que precisaria ser verdade pra voc topar?\"\n      ]\n    },\n    \"approval\": {\n      \"action\": \"fechar prximos passos com clareza e confirmao\",\n      \"questions\": [\n        \"Faz sentido seguir assim?\",\n        \"Quer que eu formalize os prximos passos?\",\n        \"Tem algo que voc quer ajustar antes de fechar?\"\n      ]\n    }\n  },\n  \"scoring_pipeline\": [\n    \"1) Calibrar baseline individual (1020s).\",\n    \"2) Registrar eventos (AUs/HEAD/GAZE/AD_EXT) com intensidade, lateralidade e\\ntiming.\",\n    \"3) Somar pesos por evento (opcional: multiplicar por intensidade AE => 0.2..1.0).\",\n    \"4) Aplicar ajustes de combo_rules quando padres ocorrerem.\",\n    \"5) Normalizar dimenses (ex.: clamp -100..+100) e mapear para 0..100 se necessrio.\",\n    \"6) Escolher ao e perguntas: use a dimenso dominante negativa\\n(resistance/stress/aversion/incongruence) ou positiva (approval/affiliation/engagement).\"\n  ],\n  \"notes\": \"Pesos so heursticos (ponto de partida). Ajuste com seus dados e validao\\nhumana.\"\n}","/**\n * FACS Configuration\n * Exporta a configurao FACS padro para uso no engine\n */\n\nimport facsConfigJson from \"../json/FACS_IA_decision_ready_v1.json\";\nimport type { FACSConfig } from \"../types/index\";\n\nexport const defaultFACSConfig: FACSConfig = facsConfigJson as FACSConfig;\n","/**\n * Sales Scoring Engine\n * Processa regras do JSON de configurao e calcula pontuaes para dimenses\n */\n\nimport type { ExpressionResult, FACSConfig, WindowPayload } from \"@type/index\";\n\nexport interface SalesScoringEngine {\n\tprocess(inputPayload: WindowPayload): ExpressionResult;\n}\n\nfunction getIntensityMultiplier(value: number, isAu: boolean = true): number {\n\tif (!isAu) {\n\t\treturn 1.0;\n\t}\n\n\tif (value >= 0.8) return 1.0; // E\n\tif (value >= 0.6) return 0.8; // D\n\tif (value >= 0.4) return 0.6; // C\n\tif (value >= 0.2) return 0.4; // B\n\tif (value >= 0.1) return 0.2; // A\n\treturn 0.0;\n}\n\nexport function createSalesScoringEngine(\n\trules: FACSConfig,\n): SalesScoringEngine {\n\tif (!rules) {\n\t\tthrow new Error(\n\t\t\t\"[ScoringEngine] rules  obrigatrio. Fornea a configurao FACS.\",\n\t\t);\n\t}\n\n\tif (!rules.weights_by_code) {\n\t\tthrow new Error(\n\t\t\t\"[ScoringEngine] Configurao invlida: 'weights_by_code' no encontrado no FACS config.\",\n\t\t);\n\t}\n\n\tif (!rules.combo_rules) {\n\t\tthrow new Error(\n\t\t\t\"[ScoringEngine] Configurao invlida: 'combo_rules' no encontrado no FACS config.\",\n\t\t);\n\t}\n\n\tif (!rules.dimensions) {\n\t\tthrow new Error(\n\t\t\t\"[ScoringEngine] Configurao invlida: 'dimensions' no encontrado no FACS config.\",\n\t\t);\n\t}\n\n\tconst weights = rules.weights_by_code;\n\tconst combos = rules.combo_rules;\n\tconst dimensionsList = Object.keys(rules.dimensions);\n\tconst actionsMap = rules.default_actions_questions || {};\n\n\tfunction process(inputPayload: WindowPayload): ExpressionResult {\n\t\tconst aus = inputPayload.aus || {};\n\t\tconst meta = inputPayload.meta || {};\n\n\t\tconst scores: Record<string, number> = {};\n\t\tfor (const dim of dimensionsList) {\n\t\t\tscores[dim] = 0.0;\n\t\t}\n\n\t\tconst activeCodes: string[] = [];\n\n\t\tfor (const [code, rawVal] of Object.entries(aus)) {\n\t\t\tconst sI = getIntensityMultiplier(rawVal, true);\n\t\t\tif (sI > 0 && code in weights) {\n\t\t\t\tactiveCodes.push(code);\n\t\t\t\tconst weightMap = weights[code] || {};\n\t\t\t\tfor (const [dim, weight] of Object.entries(weightMap)) {\n\t\t\t\t\tscores[dim] = (scores[dim] || 0) + sI * weight;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst metaSignals: string[] = [];\n\t\tconst gaze = meta.gaze || \"CENTER\";\n\t\tif (gaze === \"LOOKING_DOWN\") metaSignals.push(\"GAZE64\");\n\n\t\tconst pitch = meta.head_pitch || 0;\n\t\tif (pitch > 15) metaSignals.push(\"HEAD54\");\n\t\telse if (pitch < -15) metaSignals.push(\"HEAD53\");\n\n\t\tfor (const mCode of metaSignals) {\n\t\t\tif (mCode in weights) {\n\t\t\t\tactiveCodes.push(mCode);\n\t\t\t\tconst weightMap = weights[mCode] || {};\n\t\t\t\tfor (const [dim, weight] of Object.entries(weightMap)) {\n\t\t\t\t\tscores[dim] = (scores[dim] || 0) + 1.0 * weight; // s(empty) = 1.0\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst triggeredCombos: string[][] = [];\n\t\tfor (const combo of combos) {\n\t\t\tconst requiresMet = combo.requires.every((req) =>\n\t\t\t\tactiveCodes.includes(req),\n\t\t\t);\n\t\t\tconst forbidsMet =\n\t\t\t\tcombo.forbids && combo.forbids.length > 0\n\t\t\t\t\t? combo.forbids.some((forbid) => activeCodes.includes(forbid))\n\t\t\t\t\t: false;\n\n\t\t\tif (requiresMet && !forbidsMet) {\n\t\t\t\t// Retorna o array completo de tags do combo, ou cria array com id se no houver tag\n\t\t\t\tif (combo.tag && combo.tag.length > 0) {\n\t\t\t\t\ttriggeredCombos.push(combo.tag);\n\t\t\t\t} else if (combo.id) {\n\t\t\t\t\ttriggeredCombos.push([combo.id]);\n\t\t\t\t}\n\t\t\t\tfor (const [dim, adj] of Object.entries(combo.adjustments || {})) {\n\t\t\t\t\tscores[dim] = (scores[dim] || 0) + adj;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst finalScores: Record<string, number> = {};\n\t\tfor (const [k, v] of Object.entries(scores)) {\n\t\t\tfinalScores[k] = Math.max(-100, Math.min(100, v));\n\t\t}\n\n\t\tlet domDim = dimensionsList[0] || \"engagement\";\n\t\tlet maxAbs = Math.abs(finalScores[domDim] || 0);\n\t\tfor (const [k, v] of Object.entries(finalScores)) {\n\t\t\tconst abs = Math.abs(v);\n\t\t\tif (abs > maxAbs) {\n\t\t\t\tmaxAbs = abs;\n\t\t\t\tdomDim = k;\n\t\t\t}\n\t\t}\n\n\t\tconst actionData = actionsMap[domDim] || {\n\t\t\taction: \"Analise\",\n\t\t\tquestions: [],\n\t\t};\n\n\t\treturn {\n\t\t\tdominant_dimension: domDim,\n\t\t\tdominant_value: Math.round(finalScores[domDim] || 0),\n\t\t\tactive_combos: triggeredCombos,\n\t\t\tscores: finalScores,\n\t\t\trecommended_actions: [actionData.action],\n\t\t\tquestions: actionData.questions,\n\t\t};\n\t}\n\n\treturn {\n\t\tprocess,\n\t};\n}\n","/**\n * Gaze Tracker\n * Calcula o vetor de ateno do cliente.\n * Combina: Rotao da Cabea + Posio da ris.\n */\n\nimport type {\n\tGazeAnalysisResult,\n\tGazeStatus,\n\tLandmarkPoint,\n\tThresholdsConfig,\n} from \"@type/index\";\n\nconst IDX_IRIS_L = 468;\nconst IDX_EYE_L_CORNERS: [number, number] = [33, 133]; // Inner corner, outer corner\nconst IDX_NOSE = 1;\nconst IDX_FACE_EDGES: [number, number] = [234, 454]; // Left ear, right ear\n\nexport function createGazeTracker(config: ThresholdsConfig) {\n\tconst maxDeviation = config.safety?.max_gaze_deviation || 100;\n\n\t/**\n\t * Retorna:\n\t * - isLooking (bool): True se estiver olhando para a cmera/tela.\n\t * - deviation (float): Grau de desvio estimado (0 a 100)\n\t * - status (str): \"DIRECT\", \"THINKING_UP\", \"THINKING_DOWN\", \"SIDEWAY\"\n\t *\n\t */\n\tfunction analyze(landmarks: LandmarkPoint[]): GazeAnalysisResult {\n\t\tconst nose = landmarks[IDX_NOSE];\n\t\tconst leftEar = landmarks[IDX_FACE_EDGES[0]];\n\t\tconst rightEar = landmarks[IDX_FACE_EDGES[1]];\n\n\t\tif (!nose || !leftEar || !rightEar) {\n\t\t\treturn {\n\t\t\t\tisLooking: false,\n\t\t\t\tdeviation: 0.0,\n\t\t\t\tstatus: \"ERROR\",\n\t\t\t};\n\t\t}\n\n\t\tconst faceWidth = rightEar.x - leftEar.x;\n\t\tif (Math.abs(faceWidth) < 1e-6) {\n\t\t\treturn {\n\t\t\t\tisLooking: false,\n\t\t\t\tdeviation: 0.0,\n\t\t\t\tstatus: \"ERROR\",\n\t\t\t};\n\t\t}\n\n\t\tconst headYawRatio = (nose.x - leftEar.x) / faceWidth;\n\t\tconst headYawDeviation = Math.abs(headYawRatio - 0.5) * 200; // Scale approx 0-100\n\n\t\tconst irisL = landmarks[IDX_IRIS_L];\n\t\tconst eyeLStart = landmarks[IDX_EYE_L_CORNERS[0]];\n\t\tconst eyeLEnd = landmarks[IDX_EYE_L_CORNERS[1]];\n\n\t\tif (!irisL || !eyeLStart || !eyeLEnd) {\n\t\t\treturn {\n\t\t\t\tisLooking: false,\n\t\t\t\tdeviation: 0.0,\n\t\t\t\tstatus: \"ERROR\",\n\t\t\t};\n\t\t}\n\n\t\tconst eyeLWidth = eyeLEnd.x - eyeLStart.x;\n\n\t\tconst irisRatio =\n\t\t\tMath.abs(eyeLWidth) < 1e-6 ? 0.5 : (irisL.x - eyeLStart.x) / eyeLWidth;\n\n\t\tconst irisDeviation = Math.abs(irisRatio - 0.5) * 200; // Scale approx 0-100\n\n\t\tconst totalDeviation = headYawDeviation + irisDeviation * 0.5;\n\n\t\tconst irisY = irisL.y;\n\t\tconst eyeYCenter = (eyeLStart.y + eyeLEnd.y) / 2;\n\t\tconst verticalDiff = (irisY - eyeYCenter) * 1000;\n\n\t\tlet status: GazeStatus = \"DIRECT\";\n\t\tif (totalDeviation > maxDeviation) {\n\t\t\tif (verticalDiff < -15) {\n\t\t\t\tstatus = \"THINKING_UP\";\n\t\t\t} else if (verticalDiff > 15) {\n\t\t\t\tstatus = \"THINKING_DOWN\";\n\t\t\t} else {\n\t\t\t\tstatus = \"SIDEWAY\";\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tisLooking: false,\n\t\t\t\tdeviation: totalDeviation,\n\t\t\t\tstatus,\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tisLooking: true,\n\t\t\tdeviation: totalDeviation,\n\t\t\tstatus: \"DIRECT\",\n\t\t};\n\t}\n\n\treturn {\n\t\tanalyze,\n\t};\n}\n","/**\n * Landmark Tracker\n * Processa frames usando MediaPipe FaceLandmarker\n * Adaptado para uso com @mediapipe/tasks-vision\n */\n\nimport type {\n\tBlendshape,\n\tFaceLandmarkResult,\n\tLandmarkPoint,\n} from \"@type/index\";\n\nexport interface MediaPipeFaceLandmarker {\n\tdetectForVideo(\n\t\timage: HTMLVideoElement | HTMLImageElement | HTMLCanvasElement | ImageData,\n\t\ttimestamp: number,\n\t): FaceLandmarkerResult;\n}\n\nexport interface FaceLandmarkerResult {\n\tfaceLandmarks: Array<Array<{ x: number; y: number; z: number }>>;\n\tfaceBlendshapes?: Array<{\n\t\tcategories: Array<{ categoryName: string; score: number }>;\n\t}>;\n\t// MediaPipe retorna Matrix[] onde Matrix  um tipo especfico do MediaPipe\n\t// Aceitamos qualquer tipo compatvel (Matrix do MediaPipe ou number[][])\n\t// O tipo Matrix do MediaPipe  estruturalmente equivalente a number[][] (matriz 4x4)\n\t// Usamos um tipo genrico para aceitar o tipo Matrix do MediaPipe sem conflitos de tipo\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tfacialTransformationMatrixes?: any[];\n}\n\nexport interface LandmarkTracker {\n\tprocessFrame(\n\t\tframe: HTMLVideoElement | HTMLImageElement | HTMLCanvasElement | ImageData,\n\t\ttimestamp?: number,\n\t): FaceLandmarkResult | null;\n\tisInitialized(): boolean;\n\tgetModelPath(): string;\n}\n\nfunction convertToFaceLandmarkResult(\n\tmpResult: FaceLandmarkerResult,\n): FaceLandmarkResult {\n\t// Verificar se faceLandmarks  um array vlido\n\tif (!Array.isArray(mpResult.faceLandmarks)) {\n\t\tconsole.warn(\"faceLandmarks is not an array:\", mpResult.faceLandmarks);\n\t\treturn {\n\t\t\tfaceLandmarks: [],\n\t\t};\n\t}\n\n\tconst faceLandmarks: LandmarkPoint[][] = mpResult.faceLandmarks\n\t\t.filter((face) => Array.isArray(face))\n\t\t.map((face) =>\n\t\t\tface.map((point) => ({\n\t\t\t\tx: point.x,\n\t\t\t\ty: point.y,\n\t\t\t\tz: point.z,\n\t\t\t})),\n\t\t);\n\n\tlet faceBlendshapes: Blendshape[][] | undefined;\n\tif (mpResult.faceBlendshapes) {\n\t\t// Verificar se  um array\n\t\tif (!Array.isArray(mpResult.faceBlendshapes)) {\n\t\t\tconsole.warn(\n\t\t\t\t\"faceBlendshapes is not an array:\",\n\t\t\t\ttypeof mpResult.faceBlendshapes,\n\t\t\t\tmpResult.faceBlendshapes,\n\t\t\t);\n\t\t} else {\n\t\t\ttry {\n\t\t\t\t// MediaPipe retorna: Array<{ categories: Array<{ categoryName, score }> }>\n\t\t\t\t// Precisamos converter para: Array<Array<{ category_name, score }>>\n\t\t\t\tfaceBlendshapes = mpResult.faceBlendshapes\n\t\t\t\t\t.filter((faceBlendshape) => {\n\t\t\t\t\t\t// Verificar se tem a propriedade 'categories' e se  um array\n\t\t\t\t\t\tconst isValid =\n\t\t\t\t\t\t\tfaceBlendshape &&\n\t\t\t\t\t\t\ttypeof faceBlendshape === \"object\" &&\n\t\t\t\t\t\t\t\"categories\" in faceBlendshape &&\n\t\t\t\t\t\t\tArray.isArray(faceBlendshape.categories);\n\t\t\t\t\t\tif (!isValid && process.env.NODE_ENV === \"development\") {\n\t\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\t\"faceBlendshapes element is not in expected format:\",\n\t\t\t\t\t\t\t\ttypeof faceBlendshape,\n\t\t\t\t\t\t\t\tfaceBlendshape,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn isValid;\n\t\t\t\t\t})\n\t\t\t\t\t.map((faceBlendshape) =>\n\t\t\t\t\t\tfaceBlendshape.categories.map((blendshape) => ({\n\t\t\t\t\t\t\tcategory_name: blendshape.categoryName,\n\t\t\t\t\t\t\tscore: blendshape.score,\n\t\t\t\t\t\t})),\n\t\t\t\t\t);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Error converting faceBlendshapes:\", error);\n\t\t\t\t// Em caso de erro, continuar sem blendshapes\n\t\t\t\tfaceBlendshapes = undefined;\n\t\t\t}\n\t\t}\n\t}\n\n\tconst converted: FaceLandmarkResult = {\n\t\tfaceLandmarks,\n\t};\n\tif (faceBlendshapes) {\n\t\tconverted.faceBlendshapes = faceBlendshapes;\n\t}\n\treturn converted;\n}\n\nexport function createLandmarkTracker(\n\tdetector: MediaPipeFaceLandmarker,\n\tmodelPath: string = \"/models/face_landmarker.task\",\n): LandmarkTracker {\n\tconst initialized = true;\n\n\tfunction processFrame(\n\t\tframe: HTMLVideoElement | HTMLImageElement | HTMLCanvasElement | ImageData,\n\t\ttimestamp: number = Date.now(),\n\t): FaceLandmarkResult | null {\n\t\ttry {\n\t\t\tif (!detector || !initialized) {\n\t\t\t\tconsole.warn(\"LandmarkTracker not initialized.\");\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst detectionResult = detector.detectForVideo(frame, timestamp);\n\n\t\t\t// Verificar se o resultado  vlido\n\t\t\tif (!detectionResult) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Debug: log da estrutura retornada (apenas primeira vez)\n\t\t\tif (typeof window !== \"undefined\") {\n\t\t\t\tconst win = window as unknown as { __mpDebugLogged?: boolean };\n\t\t\t\tif (!win.__mpDebugLogged) {\n\t\t\t\t\twin.__mpDebugLogged = true;\n\t\t\t\t\tconst firstBlendshape = detectionResult.faceBlendshapes?.[0];\n\t\t\t\t\tconsole.log(\"MediaPipe result structure:\", {\n\t\t\t\t\t\thasFaceLandmarks: !!detectionResult.faceLandmarks,\n\t\t\t\t\t\tfaceLandmarksLength: Array.isArray(detectionResult.faceLandmarks)\n\t\t\t\t\t\t\t? detectionResult.faceLandmarks.length\n\t\t\t\t\t\t\t: 0,\n\t\t\t\t\t\thasFaceBlendshapes: !!detectionResult.faceBlendshapes,\n\t\t\t\t\t\tfaceBlendshapesLength: Array.isArray(\n\t\t\t\t\t\t\tdetectionResult.faceBlendshapes,\n\t\t\t\t\t\t)\n\t\t\t\t\t\t\t? detectionResult.faceBlendshapes.length\n\t\t\t\t\t\t\t: 0,\n\t\t\t\t\t\tfirstBlendshapeType: firstBlendshape\n\t\t\t\t\t\t\t? typeof firstBlendshape\n\t\t\t\t\t\t\t: \"N/A\",\n\t\t\t\t\t\tfirstBlendshapeKeys:\n\t\t\t\t\t\t\tfirstBlendshape && typeof firstBlendshape === \"object\"\n\t\t\t\t\t\t\t\t? Object.keys(firstBlendshape)\n\t\t\t\t\t\t\t\t: [],\n\t\t\t\t\t\thasCategories:\n\t\t\t\t\t\t\tfirstBlendshape && typeof firstBlendshape === \"object\"\n\t\t\t\t\t\t\t\t? \"categories\" in firstBlendshape\n\t\t\t\t\t\t\t\t: false,\n\t\t\t\t\t\tcategoriesType:\n\t\t\t\t\t\t\tfirstBlendshape &&\n\t\t\t\t\t\t\ttypeof firstBlendshape === \"object\" &&\n\t\t\t\t\t\t\t\"categories\" in firstBlendshape\n\t\t\t\t\t\t\t\t? Array.isArray(firstBlendshape.categories)\n\t\t\t\t\t\t\t\t\t? \"array\"\n\t\t\t\t\t\t\t\t\t: typeof firstBlendshape.categories\n\t\t\t\t\t\t\t\t: \"N/A\",\n\t\t\t\t\t\tcategoriesLength:\n\t\t\t\t\t\t\tfirstBlendshape &&\n\t\t\t\t\t\t\ttypeof firstBlendshape === \"object\" &&\n\t\t\t\t\t\t\t\"categories\" in firstBlendshape &&\n\t\t\t\t\t\t\tArray.isArray(firstBlendshape.categories)\n\t\t\t\t\t\t\t\t? firstBlendshape.categories.length\n\t\t\t\t\t\t\t\t: 0,\n\t\t\t\t\t\tsample: firstBlendshape,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Verificar se faceLandmarks existe e  um array\n\t\t\tif (\n\t\t\t\t!detectionResult.faceLandmarks ||\n\t\t\t\t!Array.isArray(detectionResult.faceLandmarks) ||\n\t\t\t\tdetectionResult.faceLandmarks.length === 0\n\t\t\t) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn convertToFaceLandmarkResult(detectionResult);\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error in LandmarkTracker:\", error);\n\t\t\tif (error instanceof Error) {\n\t\t\t\tconsole.error(\"Error details:\", error.message, error.stack);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tfunction isInitialized(): boolean {\n\t\treturn initialized;\n\t}\n\n\tfunction getModelPath(): string {\n\t\treturn modelPath;\n\t}\n\n\treturn {\n\t\tprocessFrame,\n\t\tisInitialized,\n\t\tgetModelPath,\n\t};\n}\n","/**\n * Visual Voice Activity Detector (Visual VAD)\n * Usa a geometria da boca para saber se a pessoa est falando.\n */\n\nimport { euclideanDistance } from \"@core/geometry_utils\";\nimport type { LandmarkPoint, ThresholdsConfig } from \"@type/index\";\n\nconst IDX_LIP_TOP = 13;\nconst IDX_LIP_BOTTOM = 14;\n\nconst IDX_NOSE = 1;\nconst IDX_CHIN = 152;\n\nexport function createVoiceActivityDetector(config: ThresholdsConfig) {\n\tconst threshold = config.vad?.speaking_threshold || 0.2;\n\n\tfunction isSpeaking(landmarks: LandmarkPoint[]): boolean {\n\t\tconst lipTop = landmarks[IDX_LIP_TOP];\n\t\tconst lipBottom = landmarks[IDX_LIP_BOTTOM];\n\n\t\tif (!lipTop || !lipBottom) return false;\n\n\t\tconst lipDist = euclideanDistance(lipTop, lipBottom);\n\n\t\tconst nose = landmarks[IDX_NOSE];\n\t\tconst chin = landmarks[IDX_CHIN];\n\n\t\tif (!nose || !chin) return false;\n\n\t\tconst faceRefDist = euclideanDistance(nose, chin);\n\n\t\tif (faceRefDist === 0) return false;\n\n\t\tconst openingRatio = lipDist / faceRefDist;\n\n\t\treturn openingRatio > threshold;\n\t}\n\n\treturn {\n\t\tisSpeaking,\n\t};\n}\n\nexport function isSpeaking(\n\tlandmarks: LandmarkPoint[],\n\tthreshold: number,\n): boolean {\n\tconst lipTop = landmarks[IDX_LIP_TOP];\n\tconst lipBottom = landmarks[IDX_LIP_BOTTOM];\n\n\tif (!lipTop || !lipBottom) return false;\n\n\tconst lipDist = euclideanDistance(lipTop, lipBottom);\n\n\tconst nose = landmarks[IDX_NOSE];\n\tconst chin = landmarks[IDX_CHIN];\n\n\tif (!nose || !chin) return false;\n\n\tconst faceRefDist = euclideanDistance(nose, chin);\n\n\tif (faceRefDist === 0) return false;\n\n\tconst openingRatio = lipDist / faceRefDist;\n\n\treturn openingRatio > threshold;\n}\n","/**\n * Face Expression Engine\n * Orquestrao do sistema de anlise de expresso facial.\n */\n\nimport { createHybridEngine } from \"@analyzers/hybrid_engine\";\nimport { createLandmarkFlowEngine } from \"@analyzers/landmark_based_flow\";\nimport { defaultThresholdsConfig } from \"@config/thresholds_config\";\nimport { defaultFACSConfig } from \"@config/facs_config\";\nimport { createSalesScoringEngine } from \"@logic/scoring_engine\";\nimport { createGazeTracker } from \"@modules/gaze_tracker\";\nimport {\n\tcreateLandmarkTracker,\n\ttype MediaPipeFaceLandmarker,\n} from \"@modules/landmark_tracker\";\nimport { createVoiceActivityDetector } from \"@modules/voice_activity\";\nimport type {\n\tActionUnits,\n\tExpressionResult,\n\tFACSConfig,\n\tMetaSignals,\n\tThresholdsConfig,\n\tWindowPayload,\n} from \"@type/index\";\n\ninterface BufferEntry {\n\taus: ActionUnits;\n\tmeta: MetaSignals;\n\ttimestamp: number;\n}\n\nexport interface FrameResult {\n\taus: ActionUnits;\n\tmeta: MetaSignals;\n\trotPenalty?: number;\n\tisStable: boolean;\n\tcurrentDecision?: ExpressionResult;\n}\n\nexport interface FaceExpressionEngineOptions {\n\tthresholdsConfig?: ThresholdsConfig;\n\tfacsConfig?: FACSConfig; // Opcional: usa defaultFACSConfig se no fornecido\n\tapiUrl?: string; // Opcional: URL da API para enviar resultados (frontend envia para backend/IA)\n\twindowSeconds?: number;\n\tfps?: number;\n}\n\nexport interface FaceExpressionEngine {\n\tprocessFrame(\n\t\tframe: HTMLVideoElement | HTMLImageElement | HTMLCanvasElement | ImageData,\n\t): Promise<FrameResult | null>;\n\tcalibrate(currentAus: ActionUnits): void;\n\tresetCalibration(): void;\n\tgetCurrentDecision(): ExpressionResult | null;\n\tclearBuffer(): void;\n\tonResult(callback: (result: FrameResult) => void): void;\n\tonDecision(callback: (decision: ExpressionResult) => void): void;\n}\n\n/**\n * Envia o resultado do scoring para a API (opcional, no bloqueante)\n */\nasync function sendToAPI(\n\tapiUrl: string,\n\tresult: ExpressionResult,\n): Promise<void> {\n\ttry {\n\t\tawait fetch(apiUrl, {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t},\n\t\t\tbody: JSON.stringify(result),\n\t\t});\n\t} catch (error) {\n\t\t// Silenciar erros de rede - no deve bloquear o processamento local\n\t\tconsole.warn(\"[Engine] Erro ao enviar para API (no bloqueante):\", error);\n\t}\n}\n\nexport function createFaceExpressionEngine(\n\toptions: FaceExpressionEngineOptions,\n\tfaceLandmarker: MediaPipeFaceLandmarker,\n): FaceExpressionEngine {\n\tconst config = options.thresholdsConfig || defaultThresholdsConfig;\n\t// Usa defaultFACSConfig se no fornecido - j est definido no mdulo\n\tconst facsConfig = options.facsConfig || defaultFACSConfig;\n\n\t// Validao do facsConfig (agora sempre tem valor, mas valida estrutura)\n\tif (!facsConfig.weights_by_code) {\n\t\tthrow new Error(\n\t\t\t\"[Engine] facsConfig invlido: 'weights_by_code' no encontrado.\\n\" +\n\t\t\t\t\"Verifique se o JSON est correto.\",\n\t\t);\n\t}\n\n\tif (!facsConfig.combo_rules) {\n\t\tthrow new Error(\n\t\t\t\"[Engine] facsConfig invlido: 'combo_rules' no encontrado.\\n\" +\n\t\t\t\t\"Verifique se o JSON est correto.\",\n\t\t);\n\t}\n\n\tif (!facsConfig.dimensions) {\n\t\tthrow new Error(\n\t\t\t\"[Engine] facsConfig invlido: 'dimensions' no encontrado.\\n\" +\n\t\t\t\t\"Verifique se o JSON est correto.\",\n\t\t);\n\t}\n\n\tconst apiUrl = options.apiUrl; // Opcional: se fornecido, envia resultados para API\n\tconst windowSeconds = options.windowSeconds || 4.0; // Janela de tempo para agregao (padro: 4 segundos)\n\tconst fps = options.fps || 30;\n\tconst windowSize = Math.floor(windowSeconds * fps); // Tamanho do buffer em frames (4s * 30fps = 120 frames)\n\n\t// Initialize engines\n\tconst tracker = createLandmarkTracker(faceLandmarker);\n\tconst gazeTracker = createGazeTracker(config);\n\tconst vad = createVoiceActivityDetector(config);\n\tconst hybridEngine = createHybridEngine();\n\t// Usar landmark-based flow (rpido, sem dependncias externas)\n\tconst flowEngine = createLandmarkFlowEngine();\n\tconst scoringEngine = createSalesScoringEngine(facsConfig);\n\n\t// Window buffer\n\tlet buffer: BufferEntry[] = [];\n\tlet lastAnalysisTime = Date.now();\n\tlet lastOpticalFlowTime = 0;\n\tconst OPTICAL_FLOW_INTERVAL = 3; // Executar optical flow a cada 3 frames (reduz de ~30fps para ~10fps)\n\tlet frameCount = 0;\n\n\t// Current state\n\tlet currentDecision: ExpressionResult | null = null;\n\n\t// Callbacks\n\tlet onResultCallback: ((result: FrameResult) => void) | undefined;\n\tlet onDecisionCallback: ((decision: ExpressionResult) => void) | undefined;\n\n\tfunction onResult(callback: (result: FrameResult) => void): void {\n\t\tonResultCallback = callback;\n\t}\n\n\tfunction onDecision(callback: (decision: ExpressionResult) => void): void {\n\t\tonDecisionCallback = callback;\n\t}\n\n\t/**\n\t * Processa um nico frame\n\t * @param frame - HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ou ImageData\n\t */\n\tasync function processFrame(\n\t\tframe: HTMLVideoElement | HTMLImageElement | HTMLCanvasElement | ImageData,\n\t): Promise<FrameResult | null> {\n\t\tif (!tracker.isInitialized()) {\n\t\t\tconsole.warn(\"[Engine] Not initialized.\");\n\t\t\treturn null;\n\t\t}\n\n\t\tconst timestamp = Date.now();\n\t\tconst detectionResult = tracker.processFrame(frame, timestamp);\n\n\t\tif (\n\t\t\t!detectionResult ||\n\t\t\t!detectionResult.faceLandmarks ||\n\t\t\tdetectionResult.faceLandmarks.length === 0\n\t\t) {\n\t\t\t// Sem face detectada - no  erro, apenas retorna null\n\t\t\treturn null;\n\t\t}\n\n\t\tconst firstLandmarks = detectionResult.faceLandmarks[0];\n\t\tif (!firstLandmarks) {\n\t\t\treturn null;\n\t\t}\n\t\tconst landmarks = firstLandmarks;\n\t\tconst blendshapes = detectionResult.faceBlendshapes?.[0] || [];\n\n\t\tlet width = 1280;\n\t\tlet height = 720;\n\n\t\tif (frame instanceof HTMLVideoElement) {\n\t\t\twidth = frame.videoWidth;\n\t\t\theight = frame.videoHeight;\n\t\t} else if (frame instanceof HTMLCanvasElement) {\n\t\t\twidth = frame.width;\n\t\t\theight = frame.height;\n\t\t} else if (frame instanceof ImageData) {\n\t\t\twidth = frame.width;\n\t\t\theight = frame.height;\n\t\t}\n\n\t\tconst { aus, rotPenalty } = hybridEngine.process(\n\t\t\tblendshapes,\n\t\t\tlandmarks,\n\t\t\twidth,\n\t\t\theight,\n\t\t);\n\n\t\tconst gazeResult = gazeTracker.analyze(landmarks);\n\t\tconst isSpeaking = vad.isSpeaking(landmarks);\n\n\t\t// Landmark-Based Flow (rpido, sem dependncias externas)\n\t\t// Executar apenas a cada N frames para reduzir carga\n\t\tframeCount++;\n\t\tconst shouldRunFlow =\n\t\t\trotPenalty < 0.3 &&\n\t\t\t(frameCount % OPTICAL_FLOW_INTERVAL === 0 || lastOpticalFlowTime === 0);\n\n\t\tif (shouldRunFlow) {\n\t\t\ttry {\n\t\t\t\tconst flowStart = performance.now();\n\t\t\t\t// Landmark-based flow  sncrono e rpido, mas mantemos como Promise para compatibilidade\n\t\t\t\tconst strains = await flowEngine.analyze(landmarks, width, height);\n\t\t\t\tconst flowTime = performance.now() - flowStart;\n\t\t\t\tlastOpticalFlowTime = flowTime;\n\n\t\t\t\tif (flowTime > 10) {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t`[Engine] Flow analysis lento: ${flowTime.toFixed(1)}ms`,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tif (strains.brow < -3.0) {\n\t\t\t\t\taus.AU4 = Math.max(aus.AU4 || 0, 0.45);\n\t\t\t\t}\n\t\t\t\tif (strains.nose < -2.5) {\n\t\t\t\t\taus.AU9 = Math.max(aus.AU9 || 0, 0.4);\n\t\t\t\t}\n\t\t\t\tif (Math.abs(strains.mouth) > 4.0) {\n\t\t\t\t\tconst mouthAus = [\"AU12\", \"AU24\", \"AU25\"] as const;\n\t\t\t\t\tfor (const mAu of mouthAus) {\n\t\t\t\t\t\tif ((aus[mAu] || 0) > 0.1) {\n\t\t\t\t\t\t\taus[mAu] = (aus[mAu] || 0) + 0.15;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// Silenciar erros de timeout ou falhas do optical flow\n\t\t\t\t// O processamento continua sem os boosts do optical flow\n\t\t\t}\n\t\t}\n\n\t\tconst nose = landmarks[1];\n\t\tconst earL = landmarks[234];\n\t\tconst earR = landmarks[454];\n\n\t\tif (nose && earL && earR) {\n\t\t\tconst faceWidth = earR.x - earL.x;\n\t\t\tconst headYaw = faceWidth !== 0 ? (nose.x - earL.x) / faceWidth : 0.5;\n\n\t\t\tconst meta: MetaSignals = {\n\t\t\t\tgaze: gazeResult.status,\n\t\t\t\tis_speaking: isSpeaking,\n\t\t\t\thead_yaw: (headYaw - 0.5) * 180,\n\t\t\t\thead_pitch: (nose.y - (earL.y + earR.y) / 2) * 200,\n\t\t\t};\n\n\t\t\tbuffer.push({\n\t\t\t\taus: { ...aus },\n\t\t\t\tmeta,\n\t\t\t\ttimestamp,\n\t\t\t});\n\n\t\t\tif (buffer.length > windowSize) {\n\t\t\t\tbuffer.shift();\n\t\t\t}\n\n\t\t\t// Verifica se passou o tempo da janela (padro: 4 segundos)\n\t\t\tconst timeSinceLastAnalysis = (timestamp - lastAnalysisTime) / 1000;\n\t\t\tif (timeSinceLastAnalysis >= windowSeconds) {\n\t\t\t\t// S processa se tiver pelo menos 80% dos frames esperados no buffer\n\t\t\t\tif (buffer.length >= windowSize * 0.8) {\n\t\t\t\t\tconst firstEntry = buffer[0];\n\t\t\t\t\tif (!firstEntry) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Agrega os AUs: calcula percentil 95 de cada AU na janela de 4 segundos\n\t\t\t\t\tconst allKeys = Object.keys(firstEntry.aus);\n\t\t\t\t\tconst summaryAus: ActionUnits = {};\n\n\t\t\t\t\tfor (const key of allKeys) {\n\t\t\t\t\t\tconst values = buffer\n\t\t\t\t\t\t\t.map((entry) => entry.aus[key] || 0)\n\t\t\t\t\t\t\t.sort((a, b) => a - b);\n\t\t\t\t\t\tconst percentile95Index = Math.floor(values.length * 0.95);\n\t\t\t\t\t\tsummaryAus[key] = values[percentile95Index] || 0;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Usa os meta signals do ltimo frame da janela\n\t\t\t\t\tconst lastEntry = buffer[buffer.length - 1];\n\t\t\t\t\tif (!lastEntry) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Prepara o payload com dados agregados da janela de 4 segundos\n\t\t\t\t\tconst windowPayload: WindowPayload = {\n\t\t\t\t\t\taus: summaryAus,\n\t\t\t\t\t\tmeta: lastEntry.meta,\n\t\t\t\t\t};\n\n\t\t\t\t\t// Processa o scoring localmente usando o scoring engine\n\t\t\t\t\tcurrentDecision = scoringEngine.process(windowPayload);\n\t\t\t\t\tlastAnalysisTime = timestamp;\n\n\t\t\t\t\t// Chama o callback local (frontend recebe o resultado)\n\t\t\t\t\tif (onDecisionCallback && currentDecision) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tonDecisionCallback(currentDecision);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.error(\"[Engine] Erro no callback onDecision:\", error);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Se apiUrl estiver configurado, envia o resultado para a API (assncrono, no bloqueante)\n\t\t\t\t\tif (apiUrl && currentDecision) {\n\t\t\t\t\t\t// Envia de forma assncrona sem bloquear o processamento\n\t\t\t\t\t\tsendToAPI(apiUrl, currentDecision).catch(() => {\n\t\t\t\t\t\t\t// Erro j tratado na funo sendToAPI\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst result: FrameResult = {\n\t\t\t\taus,\n\t\t\t\tmeta,\n\t\t\t\trotPenalty,\n\t\t\t\tisStable: buffer.length >= windowSize * 0.3,\n\t\t\t\tcurrentDecision: currentDecision || undefined,\n\t\t\t};\n\n\t\t\tif (onResultCallback) {\n\t\t\t\ttry {\n\t\t\t\t\tonResultCallback(result);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error(\"[Engine] Erro no callback onResult:\", error);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction calibrate(currentAus: ActionUnits): void {\n\t\thybridEngine.calibrate(currentAus);\n\t}\n\n\tfunction resetCalibration(): void {\n\t\thybridEngine.resetCalibration();\n\t}\n\n\tfunction getCurrentDecision(): ExpressionResult | null {\n\t\treturn currentDecision;\n\t}\n\n\tfunction clearBuffer(): void {\n\t\tbuffer = [];\n\t\tlastAnalysisTime = Date.now();\n\t}\n\n\treturn {\n\t\tprocessFrame,\n\t\tcalibrate,\n\t\tresetCalibration,\n\t\tgetCurrentDecision,\n\t\tclearBuffer,\n\t\tonResult,\n\t\tonDecision,\n\t};\n}\n\n// Export default FACS config\nexport { defaultFACSConfig } from \"@config/facs_config\";\n\n// Export types from @type/index\nexport type {\n\tActionUnits,\n\tBlendshape,\n\tExpressionResult,\n\tFACSConfig,\n\tFaceLandmarkResult,\n\tLandmarkPoint,\n\tMetaSignals,\n\tThresholdsConfig,\n\tWindowPayload,\n} from \"@type/index\";\n"]}